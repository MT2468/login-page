<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
  <title>Login</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script>
    // Manifesto PWA inline para habilitar instalação e push
    (function injetarManifestoPWA() {
      const manifest = {
        name: 'MTube',
        short_name: 'MTube',
        description: 'Experiência imersiva com vídeos, clips offline e notificações.',
        display: 'standalone',
        start_url: '/',
        theme_color: '#0f172a',
        background_color: '#ffffff',
        icons: [
          { src: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4fa.svg', sizes: '192x192', type: 'image/svg+xml' },
          { src: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4fa.svg', sizes: '512x512', type: 'image/svg+xml' }
        ],
        shortcuts: [
          { name: 'Home', url: '/#home', description: 'Ir para a página inicial' },
          { name: 'Clipes offline', url: '/#clips', description: 'Acessar seus clipes mesmo sem rede' }
        ]
      };

      const blob = new Blob([JSON.stringify(manifest)], { type: 'application/manifest+json' });
      const manifestUrl = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = manifestUrl;
      document.head.appendChild(link);
    })();
  </script>
  <style>
    :root {
      --background-color: #ffffff;
      --container-color: #ffffff;
      --text-color: #202124;
      --secondary-text-color: #5f6368;
      --button-color: #1a73e8;
      --button-hover-color: #1557b0;
      --button-active-color: #0d47a1;
      --font-family: 'Roboto', Arial, sans-serif;
      --font-size-base: 16px;
    }

    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background-color: var(--background-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100%;
      height: 100%;
    }

    html {
      height: 100%;
    }

    /* Novo fluxo de criação */
    .creator-page {
      background: #ffffff;
      border: 1px solid #e0e4ec;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      margin: 32px 24px 16px;
    }

    .creator-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }

    .creator-title small {
      display: block;
      color: #5f6368;
      margin-bottom: 4px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-size: 12px;
    }

    .creator-title h2 {
      margin: 0 0 8px;
      font-size: 24px;
      color: #202124;
    }

    .creator-title p {
      margin: 0;
      color: #5f6368;
    }

    .creator-stepper {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .creator-step {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      min-width: 200px;
      background: linear-gradient(180deg, #f8fafc 0%, #f3f6fb 100%);
      position: relative;
    }

    .creator-step::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 12px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.06);
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .creator-step.active::after,
    .creator-step.completed::after {
      opacity: 1;
    }

    .creator-step.completed {
      border-color: #1a73e8;
      background: #e8f1fc;
    }

    .creator-step .step-index {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0e7ff;
      color: #1a73e8;
      font-weight: 700;
      display: grid;
      place-items: center;
      flex-shrink: 0;
    }

    .creator-step.active .step-index,
    .creator-step.completed .step-index {
      background: #1a73e8;
      color: #fff;
    }

    .creator-step strong {
      display: block;
      color: #202124;
      margin-bottom: 2px;
    }

    .creator-step small {
      color: #5f6368;
    }

    .creator-body {
      margin-top: 24px;
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 20px;
      align-items: stretch;
    }

    /* Destaques em alta e card de fluxo */
    .insights-strip {
      margin: 0 16px 20px;
      display: grid;
      gap: 12px;
    }

    .hero-visual .insights-strip {
      margin: 18px 0 0;
      width: 100%;
      gap: 10px;
    }

    .insights-slider {
      position: relative;
      overflow: hidden;
      min-height: 190px;
      border-radius: 14px;
    }

    .insight-slide {
      display: none;
    }

    .insight-slide.active {
      display: block;
    }

    .insights-nav {
      display: inline-flex;
      gap: 8px;
      justify-content: center;
    }

    .insights-nav button {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: none;
      background: #d1d5db;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }

    .insights-nav button.active {
      background: #1a73e8;
      transform: scale(1.08);
    }

    .insight-card {
      background: linear-gradient(180deg, #ffffff 0%, #f9fbff 100%);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 10px;
      box-shadow: 0 10px 26px rgba(17, 24, 39, 0.08);
      transition: transform 0.15s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    /* Garante que apenas um insight apareça por vez no carrossel */
    .insights-slider .insight-slide:not(.active) {
      display: none !important;
    }

    .insights-slider .insight-slide.active {
      display: grid;
    }

    .insight-card:hover,
    .insight-card:focus-within {
      transform: translateY(-2px);
      border-color: #1a73e8;
      box-shadow: 0 14px 32px rgba(26, 115, 232, 0.18);
    }

    .insight-card .pill {
      display: inline-flex;
      padding: 6px 10px;
      background: rgba(26, 115, 232, 0.1);
      color: #1a73e8;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
      width: fit-content;
    }

    .insight-card h3 {
      margin: 0;
      font-size: 18px;
      color: #0f172a;
    }

    .insight-card p {
      margin: 0;
      color: #4b5563;
      font-size: 14px;
      line-height: 1.5;
    }

    .insight-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      color: #2563eb;
      font-weight: 700;
    }

    .insight-action {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      background: linear-gradient(180deg, #1a73e8 0%, #1557b0 100%);
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 8px 20px rgba(26, 115, 232, 0.32);
      transition: transform 0.15s ease, filter 0.15s ease;
    }

    .insight-action:hover {
      transform: translateY(-1px);
      filter: brightness(1.02);
    }

    /* Sobreposição do mapa de navegação */
    .experience-overlay {
      position: fixed;
      inset: 0;
      background: rgba(17, 24, 39, 0.4);
      display: grid;
      place-items: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      padding: 12px;
    }

    .experience-overlay.visible {
      opacity: 1;
      pointer-events: all;
    }

    .experience-dialog {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 28px 60px rgba(0, 0, 0, 0.24);
      width: min(1100px, 100%);
      max-height: min(90vh, 960px);
      overflow: hidden;
      display: grid;
      grid-template-rows: auto 1fr;
    }

    .experience-dialog header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px;
      border-bottom: 1px solid #e5e7eb;
      gap: 12px;
    }

    .experience-dialog header h2 {
      margin: 0;
      font-size: 18px;
      color: #0f172a;
    }

    .experience-dialog header p {
      margin: 4px 0 0;
      color: #4b5563;
      font-size: 14px;
    }

    .experience-dialog .close-modal {
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      cursor: pointer;
      color: #0f172a;
      transition: background 0.15s ease, transform 0.15s ease;
    }

    .experience-dialog .close-modal:hover {
      background: #e2e8f0;
      transform: translateY(-1px);
    }

    .experience-dialog .experience-body {
      padding: 16px 18px 20px;
      overflow: auto;
    }

    .experience-dialog .experience-map {
      margin: 0;
      box-shadow: none;
    }

    body.modal-open {
      overflow: hidden;
    }

    /* Navegação e consistência visual entre telas */
    .experience-map {
      background: linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
      border: 1px solid #e0e4ec;
      border-radius: 16px;
      padding: 20px;
      margin: 0 16px 24px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.06);
    }

    .experience-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }

    .experience-title {
      margin: 0;
      font-size: 20px;
      color: #0b172a;
    }

    .experience-description {
      margin: 4px 0 0;
      color: #4b5563;
      max-width: 720px;
    }

    .experience-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .experience-actions .hero-button {
      padding: 10px 14px;
      font-size: 14px;
    }

    .experience-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }

    .experience-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
      display: grid;
      gap: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.2s ease;
    }

    .experience-card:hover,
    .experience-card:focus-within {
      transform: translateY(-2px);
      border-color: #1a73e8;
      box-shadow: 0 12px 26px rgba(26, 115, 232, 0.14);
    }

    .experience-card h3 {
      margin: 0;
      font-size: 16px;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .experience-card p {
      margin: 0;
      color: #4b5563;
      font-size: 14px;
      line-height: 1.5;
    }

    .experience-meta {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 12px;
      color: #1a73e8;
      font-weight: 600;
    }

    .experience-action {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 12px;
      border-radius: 10px;
      background: linear-gradient(180deg, #1a73e8 0%, #1557b0 100%);
      border: none;
      color: #fff;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      justify-content: center;
      transition: filter 0.2s ease, transform 0.15s ease;
    }

    .experience-action.secondary {
      background: #f3f6fb;
      color: #1f2a44;
      border: 1px solid #d7deeb;
    }

    .experience-action:hover {
      filter: brightness(1.02);
      transform: translateY(-1px);
    }

    .experience-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .experience-badge {
      background: #f1f5f9;
      color: #111827;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .creator-main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .creator-media-card {
      border: 1px dashed #d7deeb;
      border-radius: 16px;
      padding: 20px;
      background: linear-gradient(180deg, #f9fbff 0%, #f6f8fc 100%);
      display: grid;
      grid-template-columns: 48px 1fr;
      gap: 16px;
      align-items: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.04);
    }

    .media-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: #e7efff;
      display: grid;
      place-items: center;
      margin: 0;
      color: #1a73e8;
      border: 1px solid #d9e4fb;
      flex-shrink: 0;
    }

    .media-upload-details {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .media-upload-details h4 {
      margin: 0;
      color: #202124;
      font-size: 18px;
      font-weight: 700;
    }

    .media-upload-details p {
      margin: 0;
      color: #5f6368;
      font-size: 14px;
    }

    .media-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .media-chip {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 999px;
      padding: 6px 10px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      color: #3c4043;
      font-weight: 600;
      font-size: 13px;
    }

    .creator-form-panel {
      border: 1px solid #e6eaf2;
      border-radius: 14px;
      padding: 20px;
      background: #fff;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.04);
    }

    .creator-form-panel h3 {
      margin: 0 0 12px;
      color: #202124;
    }

    .creator-form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 14px;
    }

    .creator-form-group label {
      font-weight: 600;
      color: #202124;
      font-size: 14px;
    }

    .creator-form-group input,
    .creator-form-group textarea,
    .creator-form-group select {
      padding: 12px;
      border: 1px solid #dfe3eb;
      border-radius: 10px;
      font-size: 14px;
      font-family: var(--font-family);
      color: #202124;
      background: #f9fbfd;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .creator-form-group textarea {
      min-height: 96px;
      resize: vertical;
    }

    .creator-form-group input:focus,
    .creator-form-group textarea:focus,
    .creator-form-group select:focus {
      border-color: #1a73e8;
      outline: none;
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.15);
    }

    .thumbnail-preview {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 1px dashed #d3dae6;
      border-radius: 12px;
      background: #f8fafc;
    }

    .thumbnail-preview img {
      width: 72px;
      height: 48px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #d3dae6;
      display: none;
    }

    .thumbnail-preview img.visible {
      display: block;
    }

    .creator-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 18px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .creator-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .creator-button {
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.01em;
      font-size: 14px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .creator-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .creator-button.primary {
      background: #1a73e8;
      color: #fff;
      box-shadow: 0 10px 24px rgba(26, 115, 232, 0.18);
    }

    .creator-button.secondary {
      background: #f4f6fb;
      color: #1a73e8;
      border-color: #d6e2fb;
    }

    .creator-button.ghost {
      background: #fff;
      color: #5f6368;
      border-color: #dfe3eb;
    }

    .creator-button:hover:not(:disabled) {
      transform: translateY(-1px);
    }

    .creator-loading {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #5f6368;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .creator-loading.visible {
      opacity: 1;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #d6e1f5;
      border-top-color: #1a73e8;
      animation: spin 0.9s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 9999;
    }

    .toast {
      padding: 12px 14px;
      border-radius: 10px;
      color: #202124;
      min-width: 260px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      border: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fff;
      animation: fadeIn 0.25s ease;
    }

    .toast.success {
      border-color: #9cd3a6;
      background: #effaf3;
    }

    .toast.error {
      border-color: #ef9a9a;
      background: #fff1f1;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 1024px) {
      .creator-body {
        grid-template-columns: 1fr;
      }

      .creator-media-card {
        flex-direction: column;
        align-items: flex-start;
      }

      .media-actions {
        width: 100%;
      }
    }

    @media (max-width: 640px) {
      .creator-page {
        margin: 24px 12px;
        padding: 18px;
      }

      .creator-step {
        width: 100%;
      }

      .creator-actions {
        flex-direction: column;
        align-items: flex-start;
      }

      .creator-buttons {
        width: 100%;
        justify-content: flex-start;
      }

      .media-upload-details h4 {
        font-size: 16px;
      }

      .thumbnail-preview {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 820px) {
      .login-grid {
        grid-template-columns: 1fr;
      }

      .login-container {
        padding: 22px 18px;
      }
    }

    .login-wrapper {
      width: 100%;
      max-width: 450px;
      padding: 20px;
      display: none;
    }

    .login-wrapper.visible {
      display: block;
    }

    .login-container {
      background-color: var(--container-color);
      padding: 48px 40px;
      border-radius: 12px;
      border: none;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .login-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      align-items: start;
    }

    .login-panel {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }

    .journey-wrapper {
      margin-top: 12px;
      display: grid;
      gap: 10px;
    }

    .journey-toggle {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: #0f172a;
      color: #f8fafc;
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .journey-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.22);
      background: #0c1326;
    }

    .journey-toggle svg {
      width: 18px;
      height: 18px;
    }

    .login-journey {
      background: linear-gradient(180deg, #0f172a 0%, #111827 100%);
      color: #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      display: grid;
      gap: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      transition: max-height 0.25s ease, opacity 0.25s ease, padding 0.2s ease;
      max-height: 640px;
      opacity: 1;
    }

    .login-journey.collapsed {
      max-height: 0;
      opacity: 0;
      padding-top: 0;
      padding-bottom: 0;
      border-width: 0;
    }

    .login-journey h3 {
      margin: 0;
      color: #fff;
      font-size: 18px;
    }

    .login-journey p {
      margin: 0;
      color: #d1d5db;
    }

    .login-journey-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 8px;
    }

    .login-journey-list li {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      padding: 10px 12px;
    }

    .login-journey .experience-badge {
      background: rgba(255, 255, 255, 0.1);
      color: #e5e7eb;
    }

    .login-journey .experience-action {
      justify-content: flex-start;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 32px;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .logo-icon {
      width: 90px;
      height: 65px;
    }

    .login-title {
      font-size: calc(var(--font-size-base) * 1.75);
      font-weight: 700;
      color: var(--text-color);
      margin: 0 0 32px 0;
      text-align: center;
      font-family: var(--font-family);
    }

    .form-group {
      margin-bottom: 24px;
      position: relative;
    }

    .form-group label {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: var(--font-size-base);
      font-weight: 400;
      color: var(--secondary-text-color);
      pointer-events: none;
      transition: all 0.2s ease;
      background-color: var(--container-color);
      padding: 0 4px;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 13px 15px;
      font-size: var(--font-size-base);
      border: 1px solid #dadce0;
      border-radius: 4px;
      box-sizing: border-box;
      transition: all 0.2s ease;
      background-color: var(--container-color);
      color: var(--text-color);
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus,
    input[type="text"]:not(:placeholder-shown),
    input[type="email"]:not(:placeholder-shown),
    input[type="password"]:not(:placeholder-shown) {
      outline: none;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: var(--button-color);
      border-width: 2px;
      padding: 12px 14px;
    }

    input[type="text"]:focus ~ label,
    input[type="email"]:focus ~ label,
    input[type="password"]:focus ~ label,
    input[type="text"]:not(:placeholder-shown) ~ label,
    input[type="email"]:not(:placeholder-shown) ~ label,
    input[type="password"]:not(:placeholder-shown) ~ label {
      top: 0;
      font-size: calc(var(--font-size-base) * 0.75);
      color: var(--button-color);
    }

    input[type="text"]:not(:focus):not(:placeholder-shown) ~ label,
    input[type="email"]:not(:focus):not(:placeholder-shown) ~ label,
    input[type="password"]:not(:focus):not(:placeholder-shown) ~ label {
      color: var(--secondary-text-color);
    }

    input[type="text"]:hover,
    input[type="email"]:hover,
    input[type="password"]:hover {
      border-color: #5f6368;
    }

    .remember-container {
      display: flex;
      align-items: center;
      margin-bottom: 32px;
      gap: 10px;
    }

    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      padding: 0;
      cursor: pointer;
      accent-color: var(--button-color);
      flex-shrink: 0;
    }

    .remember-container label {
      font-size: calc(var(--font-size-base) * 0.875);
      color: var(--secondary-text-color);
      margin: 0;
      padding: 0;
      cursor: pointer;
      user-select: none;
    }

    .button-container {
      display: flex;
      justify-content: center;
      margin-top: 32px;
    }

    .login-button,
    .signup-button {
      width: 100%;
      padding: 14px 24px;
      background-color: var(--button-color);
      color: #ffffff;
      border: none;
      border-radius: 4px;
      font-size: var(--font-size-base);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 0.25px;
    }

    .login-button:hover,
    .signup-button:hover {
      background-color: var(--button-hover-color);
      box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    }

    .login-button:active,
    .signup-button:active {
      background-color: var(--button-active-color);
      box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3);
    }

    .login-button:disabled,
    .signup-button:disabled {
      background-color: #dadce0;
      cursor: not-allowed;
      box-shadow: none;
    }

    .signup-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #dadce0;
      text-align: center;
    }

    .signup-text {
      font-size: calc(var(--font-size-base) * 0.875);
      color: var(--secondary-text-color);
      margin-bottom: 16px;
    }

    .signup-link {
      width: 100%;
      padding: 12px 24px;
      background-color: transparent;
      color: var(--button-color);
      border: 1px solid #dadce0;
      border-radius: 4px;
      font-size: calc(var(--font-size-base) * 0.875);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 0.25px;
    }

    .signup-link:hover {
      background-color: #f8f9fa;
      border-color: #5f6368;
    }

    .hidden {
      display: none;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      color: var(--button-color);
      text-decoration: none;
      font-size: calc(var(--font-size-base) * 0.875);
      margin-bottom: 24px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .back-link:hover {
      color: var(--button-hover-color);
      text-decoration: underline;
    }

    .message {
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: calc(var(--font-size-base) * 0.875);
      text-align: center;
    }

    .message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Home Screen Styles */
    .home-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--background-color);
      display: none;
    }

    .home-wrapper.visible {
      display: block;
    }

    .home-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background-color: var(--container-color);
      display: none;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      z-index: 150;
    }

    .home-wrapper.visible .home-header {
      display: flex;
    }

    .watch-page.visible ~ .home-wrapper .home-header {
      display: flex;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 0 0 auto;
    }

    .menu-button {
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .menu-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .header-logo-icon {
      width: 50px;
      height: 36px;
    }

    .header-logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-color);
      font-family: var(--font-family);
      letter-spacing: -0.5px;
    }

    .header-center {
      flex: 1;
      max-width: 600px;
      margin: 0 40px;
      display: flex;
      justify-content: center;
    }

    .search-container {
      width: 100%;
      display: flex;
      align-items: center;
      position: relative;
    }

    .search-input {
      flex: 1;
      border: 1px solid #ccc;
      border-radius: 40px;
      outline: none;
      padding: 6px 48px 6px 16px;
      height: 36px;
      font-size: 14px;
      background-color: var(--container-color);
      color: var(--text-color);
      font-family: var(--font-family);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-sizing: border-box;
    }

    .search-input:focus {
      border-color: var(--button-color);
      box-shadow: 0 1px 6px rgba(26, 115, 232, 0.3);
    }

    .search-input::placeholder {
      color: var(--secondary-text-color);
    }

    .search-button {
      position: absolute;
      right: 0;
      background: none;
      border: none;
      padding: 0 16px;
      cursor: pointer;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 32px;
      transition: color 0.2s ease;
    }

    .search-button:hover {
      color: var(--button-color);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 0 0 auto;
    }

    .create-button {
      position: relative;
      background: none;
      border: 1px solid #ccc;
      padding: 8px 14px;
      cursor: pointer;
      color: var(--button-color);
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      font-family: var(--font-family);
      transition: all 0.2s ease;
    }

    .create-button:hover {
      background-color: rgba(26, 115, 232, 0.1);
      border-color: var(--button-color);
    }

    .create-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background-color: var(--container-color);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
      z-index: 1000;
    }

    .create-dropdown.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .create-dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      color: var(--text-color);
      font-size: 14px;
      font-family: var(--font-family);
      transition: background-color 0.2s ease;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }

    .create-dropdown-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .create-dropdown-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .create-dropdown-item:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .create-dropdown-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .notification-button {
      position: relative;
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .notification-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }



    .home-content {
      margin-top: 56px;
      padding: 24px;
      height: calc(100% - 56px);
      overflow-y: auto;
      background: linear-gradient(180deg, #f6f8fb 0%, #ffffff 120%);
    }

    .hero-section {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      background: radial-gradient(circle at 20% 20%, rgba(26, 115, 232, 0.18), transparent 40%),
        radial-gradient(circle at 80% 0%, rgba(0, 212, 255, 0.16), transparent 45%),
        linear-gradient(120deg, #0f172a 0%, #111827 55%, #1e293b 100%);
      color: #fff;
      padding: 28px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.16);
    }

    .hero-carousel {
      display: grid;
      grid-template-columns: 2fr 1.1fr;
      gap: 28px;
      align-items: center;
    }

    .hero-content h1 {
      margin: 0 0 12px;
      font-size: 32px;
      letter-spacing: -0.02em;
    }

    .hero-content p {
      margin: 0 0 18px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.6;
    }

    .hero-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .hero-button {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .hero-button.primary {
      background: linear-gradient(120deg, #1a73e8, #00d4ff);
      box-shadow: 0 12px 28px rgba(26, 115, 232, 0.35);
    }

    .hero-button:hover {
      transform: translateY(-1px);
    }

    .hero-visual {
      position: relative;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      padding: 16px;
      backdrop-filter: blur(6px);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.15);
      min-height: 200px;
    }

    .hero-slide {
      display: none;
      flex-direction: column;
      gap: 12px;
      color: #e5edff;
    }

    .hero-slide.active {
      display: flex;
    }

    .hero-slide strong {
      font-size: 18px;
      color: #fff;
    }

    .hero-slide small {
      color: rgba(229, 237, 255, 0.8);
      line-height: 1.5;
    }

    .hero-nav {
      display: flex;
      gap: 8px;
      position: absolute;
      bottom: 16px;
      right: 16px;
    }

    .hero-nav button {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.25);
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .hero-nav button.active {
      background: #fff;
      transform: scale(1.15);
    }

    .filters-bar {
      margin: 22px 0 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .filters-header {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--secondary-text-color);
      font-weight: 700;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-size: 12px;
    }

    .content-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--secondary-text-color);
      font-size: 24px;
      font-family: var(--font-family);
    }

    /* Category Chips */
    .category-chip {
      background-color: rgba(0, 0, 0, 0.05);
      border: 1px solid transparent;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-color);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
      font-family: var(--font-family);
    }

    .category-chip:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .category-chip.active {
      background: #1a73e8;
      border-color: #0d47a1;
      color: #fff;
      box-shadow: 0 10px 22px rgba(26, 115, 232, 0.25);
    }

    /* Video Grid */
    #videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
      padding-bottom: 24px;
    }

    .video-card {
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      border-radius: 14px;
      padding: 6px;
      background: #fff;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      border: 1px solid #e6e9f2;
    }

    .video-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 36px rgba(26, 115, 232, 0.14);
    }

    .video-thumbnail-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 12px;
      overflow: hidden;
      background-color: #000;
      border-radius: 12px;
    }

    .video-card:hover .video-thumbnail-container::after {
      content: 'Assistir';
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0) 40%, rgba(0, 0, 0, 0.55) 100%);
      color: #fff;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .video-thumbnail-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      font-family: var(--font-family);
    }

    .video-info {
      padding: 12px 0;
    }

    .video-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-color);
      margin: 0 0 8px 0;
      font-family: var(--font-family);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.4;
    }

    .video-metadata {
      font-size: 14px;
      color: var(--secondary-text-color);
      font-family: var(--font-family);
      line-height: 1.4;
    }

    /* Mini Player */
    .mini-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      background: #0f172a;
      color: #fff;
      border-radius: 14px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transform: translateY(120%);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      z-index: 200;
      cursor: pointer;
    }

    .mini-player.visible {
      transform: translateY(0);
      opacity: 1;
    }

    .mini-player-thumb {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      overflow: hidden;
      background: #000;
    }

    .mini-player-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .mini-player-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.65);
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
    }

    .mini-player-body {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: linear-gradient(180deg, #111827 0%, #0b1220 100%);
    }

    .mini-channel-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      flex-shrink: 0;
    }

    .mini-player-info {
      flex: 1;
      min-width: 0;
    }

    .mini-player-title {
      margin: 0;
      font-size: 14px;
      line-height: 1.4;
      color: #e5edff;
    }

    .mini-player-meta {
      margin: 4px 0 0;
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
    }

    .mini-player-actions {
      display: flex;
      gap: 6px;
    }

    .mini-player button {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #fff;
      padding: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .mini-player button:hover {
      background: rgba(255, 255, 255, 0.16);
      transform: translateY(-1px);
    }

    @media (max-width: 1200px) {
      #videos-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      }
    }

    @media (max-width: 768px) {
      #videos-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 16px;
      }
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 56px;
      left: -240px;
      width: 240px;
      height: calc(100% - 56px);
      background-color: var(--container-color);
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      transition: left 0.3s ease;
      z-index: 99;
      overflow-y: auto;
      padding: 12px 0;
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar-overlay {
      position: fixed;
      top: 56px;
      left: 0;
      width: 100%;
      height: calc(100% - 56px);
      background-color: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 98;
    }

    .sidebar-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 12px 24px;
      cursor: pointer;
      color: var(--text-color);
      font-size: 14px;
      font-weight: 400;
      font-family: var(--font-family);
      transition: background-color 0.2s ease;
      text-decoration: none;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }

    .sidebar-item:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .sidebar-item.active {
      background-color: rgba(0, 0, 0, 0.1);
      font-weight: 500;
    }

    .sidebar-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    /* Upload Screen Styles */
    .upload-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .upload-screen.visible {
      opacity: 1;
      visibility: visible;
    }

    /* Thumbnail Modal - Higher z-index */
    #thumbnail-modal {
      z-index: 1000;
    }

    .upload-container {
      background-color: var(--container-color);
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .upload-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background-color: var(--container-color);
      z-index: 10;
    }

    .upload-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 500;
      color: var(--text-color);
      font-family: var(--font-family);
    }

    .close-upload-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      color: var(--text-color);
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .close-upload-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .upload-content {
      padding: 24px;
    }

    .upload-form-group {
      margin-bottom: 24px;
    }

    .upload-form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      margin-bottom: 8px;
      font-family: var(--font-family);
    }

    .required-indicator {
      color: #d32f2f;
      margin-left: 4px;
    }

    .upload-form-group input[type="text"],
    .upload-form-group textarea {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: var(--font-family);
      color: var(--text-color);
      background-color: var(--container-color);
      transition: border-color 0.2s ease;
    }

    .upload-form-group input[type="text"]:focus,
    .upload-form-group textarea:focus {
      outline: none;
      border-color: var(--button-color);
    }

    .upload-form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .thumbnail-section {
      margin-bottom: 24px;
    }

    .thumbnail-section h3 {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      margin: 0 0 12px 0;
      font-family: var(--font-family);
    }

    #thumbnail-preview {
      margin-bottom: 12px;
    }

    .thumbnail-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      color: var(--secondary-text-color);
    }

    .thumbnail-placeholder svg {
      color: var(--secondary-text-color);
      margin-bottom: 12px;
    }

    .thumbnail-placeholder p {
      margin: 0;
      font-size: 14px;
      font-family: var(--font-family);
    }

    .explore-thumbnails-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 12px 24px;
      background-color: transparent;
      color: var(--button-color);
      border: 1px solid var(--button-color);
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
    }

    .explore-thumbnails-button:hover {
      background-color: rgba(26, 115, 232, 0.1);
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding: 4px;
    }

    .thumbnail-item {
      position: relative;
      cursor: pointer;
      border-radius: 8px;
      overflow: hidden;
      border: 3px solid transparent;
      transition: all 0.2s ease;
      aspect-ratio: 16/9;
    }

    .thumbnail-item:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .thumbnail-item.selected {
      border-color: var(--button-color);
      box-shadow: 0 0 0 2px var(--button-color);
    }

    .thumbnail-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .thumbnail-checkmark {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background-color: var(--button-color);
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .thumbnail-item.selected .thumbnail-checkmark {
      display: flex;
    }

    .video-type-section {
      margin-bottom: 24px;
    }

    .video-type-options {
      display: flex;
      gap: 16px;
    }

    .video-type-option {
      flex: 1;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .video-type-option:hover:not(.disabled) {
      border-color: var(--button-color);
      background-color: rgba(26, 115, 232, 0.05);
    }

    .video-type-option.selected {
      border-color: var(--button-color);
      background-color: rgba(26, 115, 232, 0.1);
    }

    .video-type-option.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background-color: #f5f5f5;
    }

    .video-type-option h4 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 500;
      color: var(--text-color);
      font-family: var(--font-family);
    }

    .video-type-option p {
      margin: 0;
      font-size: 13px;
      color: var(--secondary-text-color);
      font-family: var(--font-family);
    }

    .duration-input-group {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .duration-field {
      flex: 1;
    }

    .duration-field input {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: var(--font-family);
      color: var(--text-color);
      background-color: var(--container-color);
      text-align: center;
    }

    .duration-field label {
      display: block;
      font-size: 12px;
      color: var(--secondary-text-color);
      text-align: center;
      margin-top: 4px;
      font-family: var(--font-family);
    }

    .duration-separator {
      font-size: 24px;
      font-weight: bold;
      color: var(--text-color);
      margin-top: -20px;
    }

    .upload-actions {
      padding: 16px 24px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      position: sticky;
      bottom: 0;
      background-color: var(--container-color);
    }

    .cancel-upload-button,
    .publish-button {
      padding: 10px 24px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
      border: none;
    }

    .cancel-upload-button {
      background-color: transparent;
      color: var(--text-color);
      border: 1px solid #ccc;
    }

    .cancel-upload-button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .publish-button {
      background-color: var(--button-color);
      color: white;
    }

    .publish-button:hover {
      background-color: var(--button-hover-color);
    }

    .publish-button:disabled {
      background-color: #dadce0;
      cursor: not-allowed;
    }

    @media (max-width: 768px) {
      .header-center {
        margin: 0 16px;
      }

      .header-logo-text {
        font-size: 18px;
      }

      .thumbnail-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      .video-type-options {
        flex-direction: column;
      }

      .duration-input-group {
        flex-wrap: wrap;
      }
    }

    /* Watch Page Styles */
    .watch-page {
      position: fixed;
      top: 56px;
      left: 0;
      width: 100%;
      height: calc(100% - 56px);
      background-color: var(--background-color);
      overflow-y: auto;
      display: none;
      z-index: 50;
    }

    .watch-page.visible {
      display: block;
    }

    .watch-container {
      display: flex;
      gap: 24px;
      max-width: 1920px;
      margin: 0 auto;
      padding: 24px;
    }

    .watch-primary {
      flex: 1;
      max-width: calc(100% - 424px);
    }

    .watch-secondary {
      width: 400px;
      flex-shrink: 0;
    }

    .video-player {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background-color: #000;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .video-player img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-unavailable-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: 500;
      text-align: center;
      padding: 20px;
      font-family: var(--font-family);
    }

    .video-progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background-color: rgba(255, 255, 255, 0.3);
    }

    .video-progress-fill {
      height: 100%;
      width: 100%;
      background-color: #ff0000;
    }

    .watch-title {
      font-size: 20px;
      font-weight: 500;
      color: var(--text-color);
      margin: 12px 0;
      font-family: var(--font-family);
      line-height: 1.4;
    }

    .watch-info-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 16px;
    }

    .channel-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .channel-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--button-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 18px;
      flex-shrink: 0;
      font-family: var(--font-family);
    }

    .channel-details {
      flex: 1;
    }

    .channel-name {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-color);
      font-family: var(--font-family);
    }

    .channel-subs {
      font-size: 12px;
      color: var(--secondary-text-color);
      font-family: var(--font-family);
    }

    .subscribe-button {
      background-color: var(--text-color);
      color: var(--background-color);
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
      margin-left: 12px;
    }

    .subscribe-button:hover {
      background-color: var(--secondary-text-color);
    }

    .subscribe-button.subscribed {
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--text-color);
    }

    .subscribe-button.subscribed:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .video-actions {
      display: flex;
      gap: 8px;
    }

    .action-button {
      display: flex;
      align-items: center;
      gap: 6px;
      background-color: rgba(0, 0, 0, 0.05);
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
    }

    .action-button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .action-button.liked {
      background-color: rgba(26, 115, 232, 0.1);
      color: var(--button-color);
    }

    .action-button.disliked {
      background-color: rgba(0, 0, 0, 0.15);
    }

    .action-divider {
      width: 1px;
      height: 24px;
      background-color: #e0e0e0;
      margin: 0 4px;
    }

    .watch-description {
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .watch-description-header {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      margin-bottom: 8px;
      font-family: var(--font-family);
    }

    .watch-description-text {
      font-size: 14px;
      color: var(--text-color);
      font-family: var(--font-family);
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .comments-section {
      margin-top: 24px;
    }

    .comments-header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
    }

    .comments-count {
      font-size: 20px;
      font-weight: 500;
      color: var(--text-color);
      font-family: var(--font-family);
    }

    .comment-input-container {
      display: flex;
      gap: 12px;
      margin-bottom: 32px;
    }

    .comment-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--button-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 18px;
      flex-shrink: 0;
      font-family: var(--font-family);
    }

    .comment-input-wrapper {
      flex: 1;
    }

    .comment-input {
      width: 100%;
      border: none;
      border-bottom: 1px solid #e0e0e0;
      padding: 8px 0;
      font-size: 14px;
      color: var(--text-color);
      background-color: transparent;
      font-family: var(--font-family);
      outline: none;
      transition: border-color 0.2s ease;
    }

    .comment-input:focus {
      border-bottom-color: var(--text-color);
    }

    .comment-input::placeholder {
      color: var(--secondary-text-color);
    }

    .comment-actions {
      display: none;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 12px;
    }

    .comment-input:focus ~ .comment-actions,
    .comment-input:not(:placeholder-shown) ~ .comment-actions {
      display: flex;
    }

    .comment-cancel,
    .comment-submit {
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      font-family: var(--font-family);
      border: none;
      transition: all 0.2s ease;
    }

    .comment-cancel {
      background-color: transparent;
      color: var(--text-color);
    }

    .comment-cancel:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .comment-submit {
      background-color: var(--button-color);
      color: white;
    }

    .comment-submit:hover {
      background-color: var(--button-hover-color);
    }

    .comment-submit:disabled {
      background-color: #dadce0;
      cursor: not-allowed;
    }

    @media (max-width: 1024px) {
      .watch-container {
        flex-direction: column;
      }

      .watch-primary {
        max-width: 100%;
      }

      .watch-secondary {
        width: 100%;
      }
    }

    @media (max-width: 768px) {
      .watch-container {
        padding: 12px;
      }

      .watch-info-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .video-actions {
        width: 100%;
        justify-content: space-between;
      }

      .action-button {
        flex: 1;
        justify-content: center;
      }
    }

    /* Suggested Videos Styles */
    .suggested-videos {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .suggested-video-card {
      display: flex;
      gap: 12px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      padding: 8px;
      border-radius: 8px;
    }

    .suggested-video-card:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .suggested-thumbnail-container {
      position: relative;
      width: 168px;
      aspect-ratio: 16/9;
      border-radius: 8px;
      overflow: hidden;
      background-color: #000;
      flex-shrink: 0;
    }

    .suggested-thumbnail-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .suggested-duration {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 11px;
      font-weight: 500;
      font-family: var(--font-family);
    }

    .suggested-video-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .suggested-video-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-color);
      font-family: var(--font-family);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.4;
      margin: 0;
    }

    .suggested-video-metadata {
      font-size: 12px;
      color: var(--secondary-text-color);
      font-family: var(--font-family);
      line-height: 1.4;
    }

    /* Clips Page Styles */
    .clips-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: none;
      z-index: 200;
    }

    .clips-wrapper.visible {
      display: block;
    }

    .clips-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 250;
    }

    .clips-container {
      width: 100%;
      height: 100%;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }

    .clips-container::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }

    .clip-item {
      width: 100%;
      height: 100%;
      scroll-snap-align: start;
      scroll-snap-stop: always;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .clip-video-container {
      position: relative;
      width: 100%;
      max-width: 500px;
      height: 100%;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .clip-thumbnail {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .clip-unavailable-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      font-weight: 500;
      text-align: center;
      padding: 20px;
      font-family: var(--font-family);
    }

    .clip-sidebar {
      position: absolute;
      right: 12px;
      bottom: 80px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      z-index: 10;
    }

    .clip-action-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      cursor: pointer;
      color: white;
      transition: transform 0.2s ease;
    }

    .clip-action-button:hover {
      transform: scale(1.1);
    }

    .clip-action-button.active {
      color: #ff0050;
    }

    .clip-action-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 50%;
    }

    .clip-action-button.active .clip-action-icon {
      background-color: rgba(255, 0, 80, 0.3);
    }

    .clip-action-count {
      font-size: 12px;
      font-weight: 600;
      font-family: var(--font-family);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .clip-info {
      position: absolute;
      left: 12px;
      bottom: 80px;
      right: 80px;
      z-index: 10;
      color: white;
    }

    .clip-author-section {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .clip-author-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--button-color), #ff0050);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 20px;
      flex-shrink: 0;
      font-family: var(--font-family);
      border: 2px solid white;
    }

    .clip-author-info {
      flex: 1;
    }

    .clip-author-name {
      font-size: 16px;
      font-weight: 600;
      font-family: var(--font-family);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .clip-subscribe-button {
      background-color: white;
      color: var(--text-color);
      border: none;
      padding: 8px 20px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
    }

    .clip-subscribe-button:hover {
      background-color: #f0f0f0;
    }

    .clip-subscribe-button.subscribed {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid white;
    }

    .clip-title {
      font-size: 15px;
      font-weight: 400;
      font-family: var(--font-family);
      line-height: 1.4;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .clip-navigation-hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 12px;
      font-family: var(--font-family);
      z-index: 5;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateX(-50%) translateY(0);
      }
      50% {
        transform: translateX(-50%) translateY(-10px);
      }
    }

    .clip-comment-modal {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--container-color);
      border-radius: 16px 16px 0 0;
      max-height: 70%;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 300;
      display: flex;
      flex-direction: column;
    }

    .clip-comment-modal.visible {
      transform: translateY(0);
    }

    .clip-comment-header {
      padding: 16px;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .clip-comment-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-color);
      font-family: var(--font-family);
    }

    .clip-comment-close {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      color: var(--text-color);
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .clip-comment-close:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .clip-comment-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .clip-comment-input-section {
      padding: 12px 16px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-shrink: 0;
      background-color: var(--container-color);
    }

    .clip-comment-avatar-small {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--button-color), #ff0050);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
      font-family: var(--font-family);
    }

    .clip-comment-input {
      flex: 1;
      border: 1px solid #e0e0e0;
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 14px;
      color: var(--text-color);
      background-color: rgba(0, 0, 0, 0.05);
      font-family: var(--font-family);
      outline: none;
    }

    .clip-comment-input:focus {
      border-color: var(--button-color);
      background-color: var(--container-color);
    }

    .clip-comment-send {
      background-color: var(--button-color);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: var(--font-family);
    }

    .clip-comment-send:hover {
      background-color: var(--button-hover-color);
    }

    .clip-comment-send:disabled {
      background-color: #dadce0;
      cursor: not-allowed;
    }

    .avatar-color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .avatar-color-option.selected {
      border-color: white !important;
      box-shadow: 0 0 0 2px var(--button-color);
    }

    .avatar-item {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 12px;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.05);
    }

    .avatar-item:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .avatar-item.selected {
      border-color: var(--button-color);
      box-shadow: 0 0 0 2px var(--button-color);
    }

    @media (max-width: 768px) {
      .clip-video-container {
        max-width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="login-wrapper">
   <div class="login-container"><!-- Login Screen -->
    <div id="login-screen">
     <div class="login-grid">
      <div class="login-panel">
       <div class="logo-container">
        <div class="logo">
         <svg class="logo-icon" viewbox="0 0 90 65" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="86" height="61" rx="8" fill="#1a73e8" /> <rect x="32" y="20" width="8" height="25" rx="2" fill="white" /> <rect x="50" y="20" width="8" height="25" rx="2" fill="white" />
         </svg>
        </div>
       </div>
       <h1 class="login-title" id="page-title">Fazer login</h1>
       <form id="login-form">
        <div class="form-group"><input type="text" id="username" name="username" placeholder=" " required> <label for="username" id="username-label">Usuário</label>
        </div>
        <div class="form-group"><input type="password" id="password" name="password" placeholder=" " required> <label for="password" id="password-label">Código</label>
        </div>
        <div class="remember-container"><input type="checkbox" id="remember" name="remember"> <label for="remember" id="remember-text">Lembre-se de mim?</label>
        </div>
        <div class="button-container"><button type="submit" class="login-button" id="button-text">Entrar</button>
        </div>
       </form>
       <div class="signup-section">
        <p class="signup-text" id="signup-text">Não tem uma conta?</p><button class="signup-link" id="show-signup" type="button">Criar conta</button>
       </div>
      </div>
     </div>
     <div class="journey-wrapper" aria-live="polite">
      <button class="journey-toggle" type="button" id="toggle-journey" aria-expanded="false" aria-controls="login-journey">
       <svg viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>
       <span>Ver mapa de navegação do MTube</span>
      </button>
      <aside class="login-journey collapsed" id="login-journey" aria-label="Fluxo principal do MTube">
       <h3>Mapa de navegação do MTube</h3>
       <p>Visualize rapidamente as telas principais e saiba para onde ir: login, publicação, visualização e interação.</p>
       <div class="experience-badges"><span class="experience-badge">Acessível</span><span class="experience-badge">Responsivo</span><span class="experience-badge">Fluxo guiado</span>
       </div>
       <ul class="login-journey-list">
        <li>🔐 Cadastro e login com lembrete de sessão.</li>
        <li>📺 Início com carrossel, filtros e grade responsiva.</li>
        <li>⬆️ Upload guiado com stepper e capa da galeria.</li>
        <li>▶️ Visualização única com mini-player e sugestões.</li>
        <li>💬 Comentários, likes e contagem de inscritos.</li>
       </ul><button class="experience-action secondary" type="button" id="cta-signup-journey">Começar cadastro</button>
      </aside>
     </div>
    </div><!-- Signup Screen -->
    <div id="signup-screen" class="hidden"><a class="back-link" id="back-to-login">← Voltar</a>
     <div class="logo-container">
      <div class="logo">
       <svg class="logo-icon" viewbox="0 0 90 65" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="86" height="61" rx="8" fill="#1a73e8" /> <rect x="32" y="20" width="8" height="25" rx="2" fill="white" /> <rect x="50" y="20" width="8" height="25" rx="2" fill="white" />
       </svg>
      </div>
     </div>
     <h1 class="login-title">Criar conta</h1>
     <div id="message-container"></div>
     <form id="signup-form">
      <div class="form-group"><input type="text" id="signup-username" name="username" placeholder=" " required> <label for="signup-username">Usuário</label>
      </div>
      <div class="form-group"><input type="email" id="signup-email" name="email" placeholder=" " required> <label for="signup-email">E-mail</label>
      </div>
      <div class="form-group"><input type="password" id="signup-password" name="password" placeholder=" " required> <label for="signup-password">Senha</label>
      </div>
      <div class="form-group"><input type="password" id="signup-confirm" name="confirm" placeholder=" " required> <label for="signup-confirm">Confirmar Senha</label>
      </div>
      <div class="button-container"><button type="submit" class="signup-button" id="signup-button-text">Criar conta</button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Thumbnail Explorer Modal -->
  <div id="thumbnail-modal" class="upload-screen">
   <div class="upload-container" style="max-width: 1000px;">
    <div class="upload-header">
     <h2>Selecionar miniatura</h2><button class="close-upload-button" id="close-thumbnail-modal" aria-label="Fechar">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
    </div>
    <div class="upload-content">
     <div class="thumbnail-grid" id="thumbnail-grid"><!-- Thumbnails will be loaded here -->
     </div>
    </div>
   </div>
  </div><!-- Upload Video Screen -->
    <div id="upload-screen" class="upload-screen">
   <div class="upload-container">
    <div class="upload-header">
     <h2>Preparar publicação</h2><button class="close-upload-button" id="close-upload" aria-label="Fechar">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
    </div>
    <div class="upload-content">
     <section class="creator-page" aria-label="Fluxo de publicação">
      <div class="creator-header">
       <div class="creator-title">
        <small>Novo upload</small>
        <h2>Preparar publicação</h2>
        <p>Faça o upload, complete os detalhes e acompanhe o progresso antes de publicar.</p>
       </div>
       <div class="creator-stepper" id="creator-stepper">
        <div class="creator-step active" data-step="1">
         <div class="step-index">1</div>
         <div>
          <strong>Detalhes</strong><small>Título, duração e categoria</small>
         </div>
        </div>
        <div class="creator-step" data-step="2">
         <div class="step-index">2</div>
         <div>
          <strong>Miniatura</strong><small>Escolha na galeria</small>
         </div>
        </div>
        <div class="creator-step" data-step="3">
         <div class="step-index">3</div>
         <div>
          <strong>Publicação</strong><small>Confirme e publique</small>
         </div>
        </div>
       </div>
      </div>
      <div class="creator-body">
        <div class="creator-main">
        <div class="creator-media-card" id="media-card">
         <div class="media-icon">
          <svg width="26" height="26" viewbox="0 0 24 24" fill="none" aria-hidden="true">
           <path d="M12 5l7 7-7 7-7-7 7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
           <path d="M9 12h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
         </div>
         <div class="media-upload-details">
          <h4>Envio simplificado</h4>
          <p>Os envios são automáticos. Basta preencher os detalhes, definir a duração e escolher uma miniatura na galeria.</p>
          <div class="media-meta">
           <span class="media-chip">
            <svg width="14" height="14" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 7h16M7 12h10M10 17h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg>
            Fluxo direto
           </span>
           <span class="media-chip">
            <svg width="14" height="14" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
            Sem uploads manuais
           </span>
           <span class="media-chip">
            <svg width="14" height="14" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5l7 7-7 7-7-7 7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
            Miniaturas na galeria
           </span>
          </div>
         </div>
        </div>
        <div class="creator-helpers">
         <div class="helper-card">
          <svg width="16" height="16" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14m7-7H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><span>Etapas visíveis em qualquer tela.</span>
         </div>
         <div class="helper-card">
          <svg width="16" height="16" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 7h16M7 12h10M10 17h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg><span>Detalhes compactos para mobile.</span>
         </div>
         <div class="helper-card">
          <svg width="16" height="16" viewbox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5l7 7-7 7-7-7 7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><span>Miniaturas direto da galeria.</span>
         </div>
        </div>
       </div>
       <aside class="creator-form-panel">
        <h3>Detalhes e miniatura</h3>
        <form id="upload-form">
         <div class="creator-form-group"><label for="video-title">Título</label> <input id="video-title" name="video-title" type="text" placeholder="Ex: Highlights da partida" required></div>
         <div class="creator-form-group"><label for="video-description">Descrição</label> <textarea id="video-description" name="video-description" placeholder="Conte ao público sobre o seu vídeo"></textarea></div>
         <div class="creator-form-group"><label for="video-category">Categoria</label> <select id="video-category" name="video-category" required>
           <option value="" selected disabled>Selecione uma categoria</option>
           <option value="Entretenimento">Entretenimento</option>
           <option value="Filmes &amp; TV">Filmes &amp; TV</option>
           <option value="Games">Games</option>
           <option value="Música">Música</option>
           <option value="Esportes">Esportes</option>
          </select></div>
         <div class="creator-form-group"><label>Tipo de conteúdo</label>
          <div class="video-type-options">
           <div class="video-type-option selected" id="video-type-video" data-type="video">
            <h4>Vídeo</h4>
            <p>Conteúdo padrão do YouTube</p>
           </div>
           <div class="video-type-option" id="video-type-clip" data-type="clip">
            <h4>Clip</h4>
            <p>Vídeos curtos até 60 segundos</p>
           </div>
          </div>
         </div>
         <div class="creator-form-group"><label>Duração do vídeo</label>
          <div class="duration-input-group">
           <div class="duration-field"><input type="number" id="duration-minutes" min="0" max="999" value="0" required> <label>Minutos</label>
           </div><span class="duration-separator">:</span>
           <div class="duration-field"><input type="number" id="duration-seconds" min="0" max="59" value="0" required> <label>Segundos</label>
           </div>
          </div>
         </div>
         <div class="creator-form-group"><label>Thumbnail</label>
          <div class="thumbnail-preview">
           <div class="thumbnail-placeholder" id="thumbnail-placeholder">
            <svg width="48" height="48" viewbox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" /> <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" /> <path d="M21 15l-5-5L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <p id="thumbnail-placeholder-text" style="margin: 0; color: #5f6368;">Escolha uma capa diretamente da galeria.</p>
           </div><img id="selected-thumbnail-preview" class="hidden" style="width: 100%; max-width: 300px; border-radius: 8px; border: 2px solid var(--button-color);" alt="Pré-visualização da miniatura">
           <div>
            <button type="button" class="explore-thumbnails-button" id="explore-thumbnails-button" style="margin-top: 8px;">
             <svg width="16" height="16" viewbox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right: 6px;"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" /> <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" /> <path d="M21 15l-5-5L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
             </svg>Escolher na galeria</button>
           </div>
          </div>
         </div>
        </form>
       </aside>
      </div>
      <div class="creator-actions">
       <div class="creator-loading" id="creator-loading-label"><span class="spinner"></span><span id="creator-loading-text">Processando...</span></div>
       <div class="creator-buttons">
        <button class="creator-button ghost" type="button" id="cancel-upload">Cancelar</button>
        <button class="creator-button secondary" type="button" id="draft-flow-button">Salvar rascunho</button>
        <button class="creator-button primary" type="button" id="publish-button" disabled>Publicar</button>
       </div>
      </div>
     </section>
     <div class="toast-container" id="creator-toast-container" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>
   </div>
  </div>
<!-- Home Screen -->
  <div id="home-screen" class="hidden home-wrapper"><!-- Sidebar Overlay -->
   <div class="sidebar-overlay" id="sidebar-overlay"></div><!-- Sidebar -->
   <aside class="sidebar" id="sidebar"><button class="sidebar-item active" data-section="home">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg> Início </button>
    <button class="sidebar-item" data-section="upload">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><path d="M12 3v12m0 0l4-4m-4 4-4-4M5 21h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg> Upload </button>
    <button class="sidebar-item" data-section="clips">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2" /> <path d="M9 4v16M15 4v16M4 9h16M4 15h16" stroke="currentColor" stroke-width="2" />
     </svg> Clips </button>
    <button class="sidebar-item" data-section="categories">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h10M4 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
     </svg> Categorias </button>
    <button class="sidebar-item" data-section="search">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" /> <path d="M20 20l-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
     </svg> Busca </button>
    <button class="sidebar-item" data-section="comments">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg> Comentários </button>
    <button class="sidebar-item" id="settings-button" data-section="settings">
     <svg class="sidebar-icon" viewbox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" /> <path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
     </svg> Configurações </button>
   </aside>
   <header class="home-header">
    <div class="header-left"><button class="menu-button" aria-label="Menu">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
     <div class="header-logo">
      <svg class="header-logo-icon" viewbox="0 0 90 65" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="86" height="61" rx="8" fill="#1a73e8" /> <rect x="32" y="20" width="8" height="25" rx="2" fill="white" /> <rect x="50" y="20" width="8" height="25" rx="2" fill="white" />
      </svg><span class="header-logo-text">MTube</span>
     </div>
    </div>
    <div class="header-center">
     <div class="search-container"><input type="text" class="search-input" placeholder="Pesquisar"> <button class="search-button" aria-label="Pesquisar">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" /> <path d="M20 20l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
    </div>
    <div class="header-right">
     <div style="position: relative;"><button class="create-button" id="create-button" aria-label="Criar">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg> Criar </button>
      <div class="create-dropdown" id="create-dropdown"><button class="create-dropdown-item">
        <svg class="create-dropdown-icon" viewbox="0 0 24 24" fill="none"><path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2" />
        </svg> Enviar vídeo </button>
      </div>
     </div><button class="notification-button" aria-label="Notificações">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg></button>
    </div>
   </header>
  <main class="home-content"><!-- Categories will appear here when there are videos -->
    <section class="hero-section">
     <div class="hero-carousel">
      <div class="hero-content">
       <div style="display: inline-flex; gap: 8px; padding: 6px 10px; background: rgba(255,255,255,0.12); border-radius: 999px; align-items: center; font-weight: 700; letter-spacing: 0.04em;">🔥 Em alta</div>
       <h1>Descubra, faça upload e acompanhe suas publicações.</h1>
       <p>Crie com confiança e navegue pelos destaques da semana com curadoria automática. Envie vídeos com um clique, escolha miniaturas e publique rapidinho.</p>
       <div class="hero-actions"><button class="hero-button primary" id="hero-upload">Enviar vídeo</button> <button class="hero-button" id="hero-explore">Explorar agora</button>
       </div>
      </div>
      <div class="hero-visual">
       <div class="hero-slide active" data-slide="0">
        <strong>Fluxo guiado</strong><small>Use o stepper para acompanhar upload, detalhes e revisão antes de publicar.</small>
       </div>
       <div class="hero-slide" data-slide="1">
        <strong>Miniaturas rápidas</strong><small>Selecione ou troque a thumbnail direto do seletor com pré-visualização.</small>
       </div>
       <div class="hero-slide" data-slide="2">
        <strong>Controle total</strong><small>Salve rascunhos, publique ou cancele com feedback imediato em toasts.</small>
       </div>
       <div class="hero-nav"><button class="active" data-slide-target="0"></button> <button data-slide-target="1"></button> <button data-slide-target="2"></button>
       </div>
       <div class="insights-strip" aria-label="Destaques em alta">
        <div class="insights-slider">
         <article class="insight-card insight-slide active" data-insight="0">
          <div class="pill">🔥 Em alta</div>
          <h3>Mini player sempre à mão</h3>
          <p>Continue assistindo ao rolar ou mudar de rota com o mini player fixo no canto.</p>
          <div class="insight-meta"><span>Autonomia</span><span>Experiência contínua</span>
          </div>
         </article>
         <article class="insight-card insight-slide" data-insight="1">
          <div class="pill">🔥 Em alta</div>
          <h3>Publicação guiada</h3>
          <p>Stepper simplificado com miniaturas da galeria e feedbacks claros de publicação.</p>
          <div class="insight-meta"><span>Detalhes rápidos</span><span>Miniaturas ágeis</span>
          </div>
         </article>
         <article class="insight-card insight-slide" id="experience-highlight-card" data-insight="2">
          <div class="pill">🔥 Em alta</div>
          <h3>Fluxo principal do MTube</h3>
          <p>Veja em uma aba dedicada como login, upload, visualização, clips e comentários se conectam.</p>
          <div class="insight-meta"><span>Jornada completa</span><span>Navegação consistente</span>
          </div><button class="insight-action" type="button" data-open-experience>Ver mapa completo</button>
         </article>
        </div>
        <div class="insights-nav" aria-label="Navegação dos destaques">
         <button class="active" data-insight-target="0" aria-label="Destacar mini player"></button>
         <button data-insight-target="1" aria-label="Destacar publicação guiada"></button>
         <button data-insight-target="2" aria-label="Destacar mapa de navegação"></button>
        </div>
       </div>
      </div>
     </div>
    </section>
    <section class="filters-bar">
     <div class="filters-header">
      <svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path d="M4 5h16M7 12h10M10 19h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" /></svg><span>Filtros rápidos</span>
     </div>
     <div id="categories-section" class="hidden" style="padding: 8px 0; border-bottom: 1px solid #e0e0e0; margin-bottom: 6px;">
      <div style="display: flex; gap: 10px; overflow-x: auto; padding: 0 4px;"><button class="category-chip active" data-category="all">Todos</button> <button class="category-chip" data-category="Entretenimento">Entretenimento</button> <button class="category-chip" data-category="Filmes &amp; TV">Filmes &amp; TV</button> <button class="category-chip" data-category="Games">Games</button> <button class="category-chip" data-category="Música">Música</button> <button class="category-chip" data-category="Esportes">Esportes</button>
      </div>
     </div>
    </section>
    <section style="padding: 0 8px 24px;">
     <div id="videos-grid" style="padding: 0 16px;"><!-- Videos will be loaded here -->
     </div>
    </section>
   </main>
  </div><!-- Watch Page -->
  <div id="mini-player" class="mini-player">
   <div class="mini-player-thumb">
    <img id="mini-thumbnail" src="" alt="Miniatura do vídeo">
    <div class="mini-player-duration" id="mini-duration"></div>
   </div>
   <div class="mini-player-body">
    <div class="mini-channel-avatar" id="mini-avatar"></div>
    <div class="mini-player-info">
     <p class="mini-player-title" id="mini-title"></p>
     <p class="mini-player-meta" id="mini-meta"></p>
    </div>
   <div class="mini-player-actions">
    <button id="mini-close" aria-label="Fechar mini player">✕</button>
   </div>
  </div>
 </div>
  <div class="experience-overlay" id="experience-overlay" aria-hidden="true">
   <div class="experience-dialog" role="dialog" aria-modal="true" aria-labelledby="experience-title" aria-describedby="experience-description">
    <header>
     <div>
      <h2 id="experience-title">Fluxo principal do MTube</h2>
      <p id="experience-description">Navegue entre login, upload, visualização, clipes, categorias e comentários com a mesma identidade visual e interações consistentes.</p>
     </div><button class="close-modal" type="button" id="close-experience-overlay" aria-label="Fechar mapa de navegação">✕</button>
    </header>
    <div class="experience-body">
     <section class="experience-map" aria-labelledby="experience-title">
      <div class="experience-header">
       <div>
        <h2 class="experience-title">Fluxo principal do MTube</h2>
        <p class="experience-description">Tudo o que você já tinha na home continua aqui, só que agora em uma aba destacada para explorar sem poluir a timeline.</p>
       </div>
       <div class="experience-actions"><button class="hero-button primary" id="map-start-upload">Ir para upload</button> <button class="hero-button" id="map-start-signup">Novo cadastro</button>
       </div>
      </div>
      <div class="experience-grid">
       <article class="experience-card">
        <h3>🔐 Login &amp; cadastro</h3>
        <p>Fluxo seguro com lembrete de sessão e campos acessíveis. Ideal para novos usuários.</p>
        <div class="experience-meta"><span>Entrada guiada</span><span>Senha criptografada</span>
        </div><button class="experience-action secondary" type="button" data-destination="login">Ver fluxo</button>
       </article>
       <article class="experience-card">
        <h3>🏠 Página inicial</h3>
        <p>Hero com carrossel, filtros em pílulas e grade responsiva com mini-player.</p>
        <div class="experience-meta"><span>Navegação rápida</span><span>Mini-player</span>
        </div><button class="experience-action" type="button" data-destination="home">Ir para início</button>
       </article>
       <article class="experience-card">
        <h3>⬆️ Upload</h3>
        <p>Stepper horizontal, detalhes do vídeo e capa escolhida na galeria com feedback visual.</p>
        <div class="experience-meta"><span>Stepper</span><span>Miniatura</span>
        </div><button class="experience-action" type="button" data-destination="upload">Abrir upload</button>
       </article>
       <article class="experience-card">
        <h3>▶️ Visualização</h3>
        <p>Player substituído por thumbnail com aviso, título, canal e métricas ao vivo.</p>
        <div class="experience-meta"><span>Mini player</span><span>Likes/Inscrição</span>
        </div><button class="experience-action" type="button" data-destination="watch">Ver exibição</button>
       </article>
       <article class="experience-card">
        <h3>🎬 Clips</h3>
        <p>Listagem dedicada com rolagem suave e comentários preparados para evoluir.</p>
        <div class="experience-meta"><span>Feed curto</span><span>Comentários</span>
        </div><button class="experience-action" type="button" data-destination="clips">Explorar clips</button>
       </article>
       <article class="experience-card">
        <h3>🗂️ Categorias</h3>
        <p>Pílulas temáticas como Entretenimento, Filmes &amp; TV, Games, Música e Esportes.</p>
        <div class="experience-meta"><span>Filtros</span><span>Curadoria</span>
        </div><button class="experience-action secondary" type="button" data-destination="categories">Abrir filtros</button>
       </article>
       <article class="experience-card">
        <h3>🔎 Busca</h3>
        <p>Campo fixo no cabeçalho para encontrar vídeos e navegar entre seções sem perder o contexto.</p>
        <div class="experience-meta"><span>Acessível</span><span>Focus rápido</span>
        </div><button class="experience-action secondary" type="button" data-destination="search">Ir para busca</button>
       </article>
       <article class="experience-card">
        <h3>💬 Comentários</h3>
        <p>Área dedicada na tela de visualização para interações futuras com avatar e feedback instantâneo.</p>
        <div class="experience-meta"><span>Feedback</span><span>Interação</span>
        </div><button class="experience-action" type="button" data-destination="comments">Abrir comentários</button>
       </article>
      </div>
     </section>
    </div>
   </div>
  </div>
  <div id="watch-page" class="watch-page"><!-- Header duplicado para a página de visualização -->
   <header class="home-header" style="display: flex;">
    <div class="header-left"><button class="menu-button" id="watch-menu-button" aria-label="Menu">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
     <div class="header-logo" id="watch-header-logo">
      <svg class="header-logo-icon" viewbox="0 0 90 65" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="86" height="61" rx="8" fill="#1a73e8" /> <rect x="32" y="20" width="8" height="25" rx="2" fill="white" /> <rect x="50" y="20" width="8" height="25" rx="2" fill="white" />
      </svg><span class="header-logo-text">MTube</span>
     </div>
    </div>
    <div class="header-center">
     <div class="search-container"><input type="text" class="search-input" placeholder="Pesquisar"> <button class="search-button" aria-label="Pesquisar">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" /> <path d="M20 20l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
    </div>
    <div class="header-right">
     <div style="position: relative;"><button class="create-button" id="watch-create-button" aria-label="Criar">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg> Criar </button>
      <div class="create-dropdown" id="watch-create-dropdown"><button class="create-dropdown-item" id="watch-upload-video">
        <svg class="create-dropdown-icon" viewbox="0 0 24 24" fill="none"><path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /> <rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2" />
        </svg> Enviar vídeo </button>
      </div>
     </div><button class="notification-button" aria-label="Notificações">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg></button>
    </div>
   </header>
   <div class="watch-container">
    <div class="watch-primary"><!-- Video Player -->
     <div class="video-player"><img id="watch-thumbnail" src="" alt="Video thumbnail">
      <div class="video-unavailable-overlay">
       O vídeo não está disponível por causa de limitações do site
      </div>
      <div class="video-progress-bar">
       <div class="video-progress-fill"></div>
      </div>
     </div><!-- Video Title -->
     <h1 class="watch-title" id="watch-title"></h1><!-- Video Info Row -->
     <div class="watch-info-row">
      <div class="channel-info">
       <div class="channel-avatar" id="watch-channel-avatar"></div>
       <div class="channel-details">
        <div class="channel-name" id="watch-channel-name"></div>
        <div class="channel-subs" id="watch-channel-subs">
         0 inscritos
        </div>
       </div><button class="subscribe-button" id="watch-subscribe-button">Inscrever-se</button>
      </div>
      <div class="video-actions"><button class="action-button" id="watch-like-button">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none"><path d="M7 22V11M2 13v6a2 2 0 0 0 2 2h3M7 11L14 3a2 2 0 0 1 2 2v4h5a2 2 0 0 1 2 2l-2 8a2 2 0 0 1-2 2H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg><span id="watch-like-count">0</span> </button>
       <div class="action-divider"></div><button class="action-button" id="watch-dislike-button">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M7 22V11M2 13v6a2 2 0 0 0 2 2h3M7 11L14 3a2 2 0 0 1 2 2v4h5a2 2 0 0 1 2 2l-2 8a2 2 0 0 1-2 2H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg><span id="watch-dislike-count">0</span> </button>
      </div>
     </div><!-- Video Description -->
     <div class="watch-description">
      <div class="watch-description-header" id="watch-description-header"></div>
      <div class="watch-description-text" id="watch-description-text"></div>
     </div><!-- Comments Section -->
     <div class="comments-section">
      <div class="comments-header">
       <div class="comments-count">
        0 comentários
       </div>
      </div>
      <div class="comment-input-container">
       <div class="comment-avatar" id="watch-comment-avatar"></div>
       <div class="comment-input-wrapper"><input type="text" class="comment-input" placeholder="Adicione um comentário..." id="watch-comment-input">
        <div class="comment-actions"><button class="comment-cancel" id="watch-comment-cancel">Cancelar</button> <button class="comment-submit" id="watch-comment-submit" disabled>Comentar</button>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Suggested Videos Section -->
    <div class="watch-secondary">
     <div class="suggested-videos" id="suggested-videos"><!-- Suggested videos will be loaded here -->
     </div>
    </div>
   </div>
  </div><!-- Settings Modal -->
  <div id="settings-modal" class="upload-screen">
   <div class="upload-container" style="max-width: 600px;">
    <div class="upload-header">
     <h2>Configurações de Perfil</h2><button class="close-upload-button" id="close-settings" aria-label="Fechar">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
    </div>
    <div class="upload-content">
     <div class="upload-form-group"><label>Avatar do Perfil</label>
      <div style="display: flex; align-items: center; gap: 20px; margin-top: 12px;">
       <div id="current-avatar-display" style="width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: 700; border: 3px solid var(--button-color);"></div><button type="button" class="explore-thumbnails-button" id="change-avatar-button" style="flex: 1;"> Alterar Avatar </button>
      </div>
     </div>
     <div class="upload-form-group" style="margin-top: 32px;"><label>Cor de Fundo do Avatar</label>
      <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 12px;"><button type="button" class="avatar-color-option" data-color="#1a73e8" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #1a73e8; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#d32f2f" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #d32f2f; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#388e3c" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #388e3c; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#f57c00" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #f57c00; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#7b1fa2" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #7b1fa2; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#c2185b" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #c2185b; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#0097a7" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #0097a7; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#5d4037" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #5d4037; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#455a64" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #455a64; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button> <button type="button" class="avatar-color-option" data-color="#000000" style="width: 100%; aspect-ratio: 1; border-radius: 12px; background-color: #000000; border: 3px solid transparent; cursor: pointer; transition: all 0.2s;"></button>
      </div>
     </div>
    </div>
    <div class="upload-actions"><button class="cancel-upload-button" id="cancel-settings">Cancelar</button> <button class="publish-button" id="save-settings">Salvar Alterações</button>
    </div>
   </div>
  </div><!-- Avatar Selector Modal -->
  <div id="avatar-modal" class="upload-screen">
   <div class="upload-container" style="max-width: 800px;">
    <div class="upload-header">
     <h2>Escolher Avatar</h2><button class="close-upload-button" id="close-avatar-modal" aria-label="Fechar">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
    </div>
    <div class="upload-content">
     <div id="avatar-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 16px; max-height: 500px; overflow-y: auto; padding: 4px;"><!-- Avatars will be loaded here -->
     </div>
    </div>
   </div>
  </div><!-- Clips Page -->
  <div id="clips-page" class="clips-wrapper">
   <header class="clips-header"><button class="menu-button" id="clips-back-button" aria-label="Voltar" style="color: white;">
     <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
     </svg></button>
    <div style="position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 8px;">
     <svg width="36" height="36" viewbox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><defs>
       <lineargradient id="clipsGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#1a73e8;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:1" />
       </lineargradient>
      </defs> <rect x="4" y="4" width="40" height="40" rx="10" fill="url(#clipsGradient)" /> <rect x="16" y="14" width="5" height="20" rx="1.5" fill="white" /> <rect x="27" y="14" width="5" height="20" rx="1.5" fill="white" />
     </svg><span style="color: white; font-size: 20px; font-weight: 700; font-family: var(--font-family); letter-spacing: 0.5px;">Clips</span>
    </div><button class="menu-button" aria-label="Buscar" style="color: white; margin-left: auto;">
     <svg width="24" height="24" viewbox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" /> <path d="M20 20l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
     </svg></button>
   </header>
   <div class="clips-container" id="clips-container"><!-- Clips will be loaded here -->
   </div><!-- Comment Modal -->
   <div class="clip-comment-modal" id="clip-comment-modal">
    <div class="clip-comment-header">
     <h3>Comentários</h3><button class="clip-comment-close" id="clip-comment-close" aria-label="Fechar">
      <svg width="20" height="20" viewbox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg></button>
    </div>
    <div class="clip-comment-list" id="clip-comment-list">
     <p style="text-align: center; color: var(--secondary-text-color); padding: 40px 20px;">Ainda não há comentários</p>
    </div>
    <div class="clip-comment-input-section">
     <div class="clip-comment-avatar-small" id="clip-comment-avatar"></div><input type="text" class="clip-comment-input" placeholder="Adicionar comentário..." id="clip-comment-input"> <button class="clip-comment-send" id="clip-comment-send" disabled>Enviar</button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#ffffff",
      container_color: "#ffffff",
      text_color: "#202124",
      secondary_text_color: "#5f6368",
      button_color: "#1a73e8",
      font_family: "Roboto",
      font_size: 16,
      page_title: "Fazer login",
      username_label: "Usuário",
      password_label: "Código",
      remember_text: "Lembre-se de mim?",
      button_text: "Entrar",
      signup_text: "Não tem uma conta?",
      signup_button: "Criar conta"
    };

    let allData = [];
    let currentUsername = null;
    let currentUserAvatar = null;
    let currentUserAvatarColor = '#1a73e8';
    let selectedCategory = 'all';
    let currentWatchingVideo = null;
    let heroInterval = null;
    let insightInterval = null;
    let userInteractions = {}; // Store likes, dislikes, subscriptions per video

    const LOCAL_VIDEOS_KEY = 'local_videos_cache';
    const LOCAL_PROFILE_KEY = 'local_profile_cache';

    function loadLocalVideos() {
      try {
        const stored = JSON.parse(localStorage.getItem(LOCAL_VIDEOS_KEY) || '[]');
        if (!Array.isArray(stored) || stored.length === 0) return;

        const existingIds = new Set(allData.map(item => item.__backendId));
        const newEntries = stored.filter(item => item?.__backendId && !existingIds.has(item.__backendId));

        if (newEntries.length > 0) {
          allData = [...allData, ...newEntries];
          renderVideos();
        }
      } catch (error) {
        console.error('Erro ao carregar vídeos locais', error);
      }
    }

    function persistLocalVideo(video) {
      try {
        const stored = JSON.parse(localStorage.getItem(LOCAL_VIDEOS_KEY) || '[]');
        const filtered = Array.isArray(stored) ? stored.filter(item => item.__backendId !== video.__backendId) : [];
        filtered.push(video);
        localStorage.setItem(LOCAL_VIDEOS_KEY, JSON.stringify(filtered));
      } catch (error) {
        console.error('Erro ao salvar vídeo localmente', error);
      }
    }

    function getCachedProfile(username) {
      if (!username) return null;

      try {
        const cache = JSON.parse(localStorage.getItem(LOCAL_PROFILE_KEY) || '{}');
        if (cache && cache[username]) {
          return cache[username];
        }
      } catch (error) {
        console.error('Erro ao carregar perfil local', error);
      }
      return null;
    }

    function persistLocalProfile(username, avatar, color) {
      if (!username) return;

      try {
        const cache = JSON.parse(localStorage.getItem(LOCAL_PROFILE_KEY) || '{}');
        cache[username] = { userAvatar: avatar, userAvatarColor: color };
        localStorage.setItem(LOCAL_PROFILE_KEY, JSON.stringify(cache));
      } catch (error) {
        console.error('Erro ao salvar perfil local', error);
      }
    }

    function applyProfileFromSources(username, userRecord) {
      const cachedProfile = getCachedProfile(username);

      currentUserAvatar = userRecord?.userAvatar || cachedProfile?.userAvatar || username?.charAt(0).toUpperCase() || 'U';
      currentUserAvatarColor = userRecord?.userAvatarColor || cachedProfile?.userAvatarColor || '#1a73e8';
    }

    function updateUserAssetsAcrossApp(username, avatar, color, options = { render: true, syncBackend: false }) {
      if (!username) return;

      const userIndex = allData.findIndex(item => item.username && item.password && item.username === username);
      if (userIndex !== -1) {
        allData[userIndex] = { ...allData[userIndex], userAvatar: avatar, userAvatarColor: color };
      }

      const userVideos = allData.filter(item => item.videoTitle && item.videoAuthor === username);

      for (const video of userVideos) {
        const updatedVideo = {
          ...video,
          videoAuthorAvatar: avatar,
          videoAuthorAvatarColor: color
        };

        const index = allData.findIndex(item => item.__backendId === video.__backendId);
        if (index !== -1) {
          allData[index] = updatedVideo;
          persistLocalVideo(updatedVideo);
          if (options.syncBackend && window.dataSdk?.update) {
            window.dataSdk.update(updatedVideo).catch(error => {
              console.error('Erro ao atualizar vídeo no SDK', error);
            });
          }
        }
      }

      if (currentWatchingVideo && currentWatchingVideo.videoAuthor === username) {
        const refreshed = allData.find(item => item.__backendId === currentWatchingVideo.__backendId);
        if (refreshed) {
          currentWatchingVideo = refreshed;
          updateWatchPage(currentWatchingVideo);
        }
      }

      if (options.render) {
        renderVideos();
        if (typeof renderClips === 'function') {
          renderClips();
        }
      }
    }

    async function persistVideo(newVideo) {
      if (window.dataSdk?.create) {
        try {
          const result = await window.dataSdk.create(newVideo);
          if (result?.isOk) {
            return {
              ...newVideo,
              __backendId: result.data?.__backendId || result.data?.id || newVideo.__backendId
            };
          }
        } catch (error) {
          console.error('Erro ao salvar via data SDK', error);
        }
      }

      persistLocalVideo(newVideo);
      return newVideo;
    }

    // Available avatar emojis (stickers without background)
    const availableAvatars = [
      '😀', '😃', '😄', '😁', '😆', '😅', '🤣', '😂', '🙂', '🙃',
      '😉', '😊', '😇', '🥰', '😍', '🤩', '😘', '😗', '😚', '😙',
      '😋', '😛', '😜', '🤪', '😝', '🤑', '🤗', '🤭', '🤫', '🤔',
      '🤐', '🤨', '😐', '😑', '😶', '😏', '😒', '🙄', '😬', '🤥',
      '😌', '😔', '😪', '🤤', '😴', '😷', '🤒', '🤕', '🤢', '🤮',
      '🤧', '🥵', '🥶', '🥴', '😵', '🤯', '🤠', '🥳', '😎', '🤓',
      '🧐', '😕', '😟', '🙁', '☹️', '😮', '😯', '😲', '😳', '🥺',
      '😦', '😧', '😨', '😰', '😥', '😢', '😭', '😱', '😖', '😣',
      '😞', '😓', '😩', '😫', '🥱', '😤', '😡', '😠', '🤬', '👿',
      '💀', '☠️', '💩', '🤡', '👹', '👺', '👻', '👽', '👾', '🤖',
      '😺', '😸', '😹', '😻', '😼', '😽', '🙀', '😿', '😾', '🐶',
      '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁',
      '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦', '🐤', '🦆', '🦉',
      '🦇', '🐺', '🐗', '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐞',
      '🐜', '🦟', '🦗', '🕷️', '🦂', '🐢', '🐍', '🦎', '🦖', '🦕',
      '🐙', '🦑', '🦐', '🦞', '🦀', '🐡', '🐠', '🐟', '🐬', '🐳',
      '🐋', '🦈', '🐊', '🐅', '🐆', '🦓', '🦍', '🦧', '🐘', '🦛',
      '🦏', '🐪', '🐫', '🦒', '🦘', '🐃', '🐂', '🐄', '🐎', '🐖',
      '🐏', '🐑', '🦙', '🐐', '🦌', '🐕', '🐩', '🦮', '🐈', '🐓'
    ];

    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        if (currentUsername) {
          const userRecord = allData.find(item => item.username && item.password && item.username === currentUsername);
          applyProfileFromSources(currentUsername, userRecord);
          updateUserAssetsAcrossApp(currentUsername, currentUserAvatar, currentUserAvatarColor, { render: false });
        }
        loadLocalVideos();
        renderVideos();
      }
    };

    async function initializeApp() {
      try {
        if (window.dataSdk?.init) {
          const initResult = await window.dataSdk.init(dataHandler);
          if (initResult.isOk) {
            loadLocalVideos();
          } else {
            console.error("Failed to initialize data SDK");
            loadLocalVideos();
          }
        } else {
          loadLocalVideos();
        }
      } catch (error) {
        console.error("Failed to initialize data SDK", error);
        loadLocalVideos();
      }
    }

    async function onConfigChange(config) {
      const root = document.documentElement;
      
      // Update CSS variables
      root.style.setProperty('--background-color', config.background_color || defaultConfig.background_color);
      root.style.setProperty('--container-color', config.container_color || defaultConfig.container_color);
      root.style.setProperty('--text-color', config.text_color || defaultConfig.text_color);
      root.style.setProperty('--secondary-text-color', config.secondary_text_color || defaultConfig.secondary_text_color);
      root.style.setProperty('--button-color', config.button_color || defaultConfig.button_color);
      
      // Calculate hover/active colors based on button color
      const buttonColor = config.button_color || defaultConfig.button_color;
      root.style.setProperty('--button-hover-color', adjustColorBrightness(buttonColor, -15));
      root.style.setProperty('--button-active-color', adjustColorBrightness(buttonColor, -30));
      
      // Update font family
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Roboto, Arial, sans-serif';
      root.style.setProperty('--font-family', `${customFont}, ${baseFontStack}`);
      
      // Update font size
      const baseSize = config.font_size || defaultConfig.font_size;
      root.style.setProperty('--font-size-base', `${baseSize}px`);

      // Update text content
      const pageTitle = document.getElementById('page-title');
      if (pageTitle) {
        pageTitle.textContent = config.page_title || defaultConfig.page_title;
      }
      const usernameLabel = document.getElementById('username-label');
      if (usernameLabel) {
        usernameLabel.textContent = config.username_label || defaultConfig.username_label;
      }
      const passwordLabel = document.getElementById('password-label');
      if (passwordLabel) {
        passwordLabel.textContent = config.password_label || defaultConfig.password_label;
      }
      const rememberText = document.getElementById('remember-text');
      if (rememberText) {
        rememberText.textContent = config.remember_text || defaultConfig.remember_text;
      }
      const buttonText = document.getElementById('button-text');
      if (buttonText) {
        buttonText.textContent = config.button_text || defaultConfig.button_text;
      }
      const signupTextEl = document.getElementById('signup-text');
      if (signupTextEl) {
        signupTextEl.textContent = config.signup_text || defaultConfig.signup_text;
      }
      const showSignup = document.getElementById('show-signup');
      if (showSignup) {
        showSignup.textContent = config.signup_button || defaultConfig.signup_button;
      }
    }

    // Helper function to adjust color brightness
    function adjustColorBrightness(color, percent) {
      const num = parseInt(color.replace("#",""), 16);
      const amt = Math.round(2.55 * percent);
      const R = Math.max(0, Math.min(255, (num >> 16) + amt));
      const G = Math.max(0, Math.min(255, (num >> 8 & 0x00FF) + amt));
      const B = Math.max(0, Math.min(255, (num & 0x0000FF) + amt));
      return "#" + (0x1000000 + (R << 16) + (G << 8) + B).toString(16).slice(1);
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.container_color || defaultConfig.container_color,
            set: (value) => {
              config.container_color = value;
              window.elementSdk.setConfig({ container_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.button_color || defaultConfig.button_color,
            set: (value) => {
              config.button_color = value;
              window.elementSdk.setConfig({ button_color: value });
            }
          },
          {
            get: () => config.secondary_text_color || defaultConfig.secondary_text_color,
            set: (value) => {
              config.secondary_text_color = value;
              window.elementSdk.setConfig({ secondary_text_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["page_title", config.page_title || defaultConfig.page_title],
        ["username_label", config.username_label || defaultConfig.username_label],
        ["password_label", config.password_label || defaultConfig.password_label],
        ["remember_text", config.remember_text || defaultConfig.remember_text],
        ["button_text", config.button_text || defaultConfig.button_text],
        ["signup_text", config.signup_text || defaultConfig.signup_text],
        ["signup_button", config.signup_button || defaultConfig.signup_button]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    initializeApp();

    // Check if user should be remembered on page load
    (function() {
      const rememberMe = localStorage.getItem('rememberMe');
      const savedUsername = localStorage.getItem('savedUsername');
      
      if (rememberMe === 'true' && savedUsername) {
        currentUsername = savedUsername;

        applyProfileFromSources(savedUsername, null);

        // Load user profile from database
        setTimeout(() => {
          const userExists = allData.find(item =>
            item.username && item.password && item.username === savedUsername
          );
          if (userExists) {
            applyProfileFromSources(savedUsername, userExists);
            updateUserAssetsAcrossApp(savedUsername, currentUserAvatar, currentUserAvatarColor);
          }
        }, 500);
        
        // Auto-login: go directly to home screen
        document.getElementById('home-screen').classList.add('visible');
        setTimeout(() => renderVideos(), 100);
      } else {
        // Show login screen
        document.querySelector('.login-wrapper').classList.add('visible');
      }
    })();

    // Screen navigation
    document.getElementById('show-signup').addEventListener('click', () => {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('signup-screen').classList.remove('hidden');
    });

    document.getElementById('back-to-login').addEventListener('click', () => {
      document.getElementById('signup-screen').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('message-container').innerHTML = '';
      document.getElementById('signup-form').reset();
    });

    // Login form
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const rememberCheckbox = document.getElementById('remember');
      const loginContainer = document.querySelector('.login-container');

      // Check if user exists in database (only check user records, not video records)
      const userExists = allData.find(item => 
        item.username && item.password && 
        item.username === username && item.password === password
      );

      // Remove any existing error messages
      const existingError = loginContainer.querySelector('.message.error');
      if (existingError) {
        existingError.remove();
      }

      if (!userExists) {
        // Show error message
        const errorMessage = document.createElement('div');
        errorMessage.className = 'message error';
        errorMessage.textContent = 'Usuário ou senha inválidos!';
        errorMessage.style.marginBottom = '16px';
        loginContainer.insertBefore(errorMessage, document.getElementById('login-screen'));
        
        // Remove error message after 4 seconds
        setTimeout(() => {
          errorMessage.remove();
        }, 4000);
        return;
      }

      // Valid login - proceed
      currentUsername = username;

      // Carrega perfil considerando banco e cache local
      applyProfileFromSources(username, userExists);

      // Save remember me preference
      if (rememberCheckbox.checked) {
        localStorage.setItem('rememberMe', 'true');
        localStorage.setItem('savedUsername', username);
      } else {
        localStorage.removeItem('rememberMe');
        localStorage.removeItem('savedUsername');
      }

      // Smooth transition to home screen
      document.querySelector('.login-wrapper').classList.remove('visible');
      document.getElementById('home-screen').classList.add('visible');
      updateUserAssetsAcrossApp(currentUsername, currentUserAvatar, currentUserAvatarColor);
      setTimeout(() => renderVideos(), 100);
    });

    // Sidebar functionality
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const menuButton = document.querySelector('.menu-button');

    if (menuButton) {
      menuButton.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('visible');
      });
    }

    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('visible');
      });
    }

    // Settings modal
    const settingsButton = document.getElementById('settings-button');
    const settingsModal = document.getElementById('settings-modal');
    const closeSettings = document.getElementById('close-settings');
    const cancelSettings = document.getElementById('cancel-settings');
    const saveSettings = document.getElementById('save-settings');
    const changeAvatarButton = document.getElementById('change-avatar-button');
    const avatarModal = document.getElementById('avatar-modal');
    const closeAvatarModal = document.getElementById('close-avatar-modal');
    
    let tempAvatar = null;
    let tempAvatarColor = null;
    
    if (settingsButton) {
      settingsButton.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('visible');
        
        // Load current profile settings
        tempAvatar = currentUserAvatar;
        tempAvatarColor = currentUserAvatarColor;
        
        // Update display
        const avatarDisplay = document.getElementById('current-avatar-display');
        avatarDisplay.textContent = currentUserAvatar;
        avatarDisplay.style.backgroundColor = currentUserAvatarColor;
        
        // Select current color
        document.querySelectorAll('.avatar-color-option').forEach(option => {
          if (option.dataset.color === currentUserAvatarColor) {
            option.classList.add('selected');
          } else {
            option.classList.remove('selected');
          }
        });
        
        settingsModal.classList.add('visible');
      });
    }
    
    if (closeSettings) {
      closeSettings.addEventListener('click', () => {
        settingsModal.classList.remove('visible');
      });
    }
    
    if (cancelSettings) {
      cancelSettings.addEventListener('click', () => {
        settingsModal.classList.remove('visible');
      });
    }
    
    if (changeAvatarButton) {
      changeAvatarButton.addEventListener('click', () => {
        loadAvatars();
        avatarModal.classList.add('visible');
      });
    }
    
    if (closeAvatarModal) {
      closeAvatarModal.addEventListener('click', () => {
        avatarModal.classList.remove('visible');
      });
    }
    
    // Avatar color selection
    document.querySelectorAll('.avatar-color-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.avatar-color-option').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        tempAvatarColor = option.dataset.color;
        
        const avatarDisplay = document.getElementById('current-avatar-display');
        avatarDisplay.style.backgroundColor = tempAvatarColor;
      });
    });
    
    // Load avatars
    function loadAvatars() {
      const avatarGrid = document.getElementById('avatar-grid');
      avatarGrid.innerHTML = '';
      
      availableAvatars.forEach(emoji => {
        const avatarItem = document.createElement('div');
        avatarItem.className = 'avatar-item';
        avatarItem.textContent = emoji;
        
        if (emoji === tempAvatar) {
          avatarItem.classList.add('selected');
        }
        
        avatarItem.addEventListener('click', () => {
          document.querySelectorAll('.avatar-item').forEach(item => item.classList.remove('selected'));
          avatarItem.classList.add('selected');
          tempAvatar = emoji;
          
          // Update display
          const avatarDisplay = document.getElementById('current-avatar-display');
          avatarDisplay.textContent = emoji;
          
          // Close modal
          avatarModal.classList.remove('visible');
        });
        
        avatarGrid.appendChild(avatarItem);
      });
    }
    
    // Save settings
    if (saveSettings) {
      saveSettings.addEventListener('click', async () => {
        saveSettings.disabled = true;
        saveSettings.textContent = 'Salvando...';

        // Find user in database
        const userRecord = allData.find(item =>
          item.username && item.password && item.username === currentUsername
        );

        if (userRecord) {
          // Atualiza perfil do usuário com tolerância a falhas
          const updatedUser = {
            ...userRecord,
            userAvatar: tempAvatar,
            userAvatarColor: tempAvatarColor
          };

          try {
            if (window.dataSdk?.update) {
              await window.dataSdk.update(updatedUser);
            }
          } catch (error) {
            console.error('Erro ao atualizar perfil no SDK', error);
          }

          const userIndex = allData.findIndex(item =>
            item.username && item.password && item.username === currentUsername
          );

          if (userIndex !== -1) {
            allData[userIndex] = updatedUser;
          }
        }

        // Atualiza estado atual e persiste cache local para manter após recarregar
        currentUserAvatar = tempAvatar;
        currentUserAvatarColor = tempAvatarColor;
        persistLocalProfile(currentUsername, currentUserAvatar, currentUserAvatarColor);

        // Atualiza todos os vídeos, clips e miniaturas com o novo avatar
        updateUserAssetsAcrossApp(currentUsername, currentUserAvatar, currentUserAvatarColor, { syncBackend: true });

        saveSettings.disabled = false;
        saveSettings.textContent = 'Salvar Alterações';
        settingsModal.classList.remove('visible');
      });
    }

    // Sidebar items
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    sidebarItems.forEach((item) => {
      item.addEventListener('click', () => {
        if (item.id === 'settings-button') {
          return;
        }

        sidebarItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('visible');

        const destination = item.dataset.section;
        if (destination) {
          navigateToSection(destination);
        }
      });
    });

    // Category filtering
    function setupCategoryFilters() {
      const categoryChips = document.querySelectorAll('.category-chip');
      categoryChips.forEach(chip => {
        chip.addEventListener('click', () => {
          categoryChips.forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          selectedCategory = chip.dataset.category;
          renderVideos();
        });
      });
    }

    // Format time ago
    function formatTimeAgo(publishedAt) {
      const now = new Date();
      const published = new Date(publishedAt);
      const diffMs = now - published;
      const diffSecs = Math.floor(diffMs / 1000);
      const diffMins = Math.floor(diffSecs / 60);
      const diffHours = Math.floor(diffMins / 60);
      const diffDays = Math.floor(diffHours / 24);
      const diffMonths = Math.floor(diffDays / 30);
      const diffYears = Math.floor(diffDays / 365);

      if (diffSecs < 60) return 'agora mesmo';
      if (diffMins < 60) return `há ${diffMins} minuto${diffMins > 1 ? 's' : ''}`;
      if (diffHours < 24) return `há ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
      if (diffDays < 30) return `há ${diffDays} dia${diffDays > 1 ? 's' : ''}`;
      if (diffMonths < 12) return `há ${diffMonths} ${diffMonths > 1 ? 'meses' : 'mês'}`;
      return `há ${diffYears} ano${diffYears > 1 ? 's' : ''}`;
    }

    // Format duration
    function formatDuration(totalSeconds) {
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }
      return `${minutes}:${String(seconds).padStart(2, '0')}`;
    }

    // Format views
    function formatViews(views) {
      if (views === 0) return '0 visualizações';
      if (views === 1) return '1 visualização';
      if (views < 1000) return `${views} visualizações`;
      if (views < 1000000) return `${(views / 1000).toFixed(1)}K visualizações`;
      return `${(views / 1000000).toFixed(1)}M visualizações`;
    }

    // Render videos
    function renderVideos() {
      const videosGrid = document.getElementById('videos-grid');
      const categoriesSection = document.getElementById('categories-section');
      
      // Filter videos (only records that have videoTitle and are not clips)
      let videos = allData.filter(item => item.videoTitle && item.videoType !== 'clip');
      
      if (videos.length === 0) {
        categoriesSection.classList.add('hidden');
        videosGrid.innerHTML = '';
        return;
      }

      // Show categories section
      categoriesSection.classList.remove('hidden');
      setupCategoryFilters();

      // Filter by selected category
      if (selectedCategory !== 'all') {
        videos = videos.filter(video => video.videoCategory === selectedCategory);
      }

      // Sort by published date (newest first)
      videos.sort((a, b) => new Date(b.videoPublishedAt) - new Date(a.videoPublishedAt));

      // Render video cards
      videosGrid.innerHTML = videos.map(video => {
        const authorAvatar = video.videoAuthorAvatar || video.videoAuthor.charAt(0).toUpperCase();
        const authorAvatarColor = video.videoAuthorAvatarColor || '#1a73e8';
        
        return `
        <div class="video-card" data-video-id="${video.__backendId}">
          <div class="video-thumbnail-container">
            <img src="${video.videoThumbnail}" alt="${video.videoTitle}">
            <div class="video-duration">${formatDuration(video.videoDuration)}</div>
          </div>
          <div class="video-info" style="display: flex; gap: 12px;">
            <div style="width: 36px; height: 36px; border-radius: 50%; background-color: ${authorAvatarColor}; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 600; flex-shrink: 0; color: white;">${authorAvatar}</div>
            <div style="flex: 1; min-width: 0;">
              <h3 class="video-title">${video.videoTitle}</h3>
              <div class="video-metadata">
                ${video.videoAuthor}<br>
                ${formatViews(video.videoViews || 0)} • ${formatTimeAgo(video.videoPublishedAt)}
              </div>
            </div>
          </div>
        </div>
      `;
      }).join('');

      // Add click handlers to video cards
      const videoCards = videosGrid.querySelectorAll('.video-card');
      videoCards.forEach(card => {
        card.addEventListener('click', async () => {
          const videoId = card.dataset.videoId;
          const video = allData.find(item => item.__backendId === videoId);

          if (video) {
            // Incrementa visualizações e abre a tela de exibição
            const updatedVideo = { ...video, videoViews: (video.videoViews || 0) + 1 };
            try {
              if (window.dataSdk?.update) {
                await window.dataSdk.update(updatedVideo);
              } else {
                persistLocalVideo(updatedVideo);
              }
            } catch (err) {
              console.error('Erro ao atualizar visualizações', err);
              persistLocalVideo(updatedVideo);
            }

            const index = allData.findIndex(item => item.__backendId === videoId);
            if (index !== -1) {
              allData[index] = updatedVideo;
            }

            renderVideos();
            openWatchPage(updatedVideo.__backendId);
          }
        });
      });
    }

    // Open watch page with video data
    function openWatchPage(videoId) {
      const video = allData.find(item => item.__backendId === videoId);
      if (!video) return;

      currentWatchingVideo = video;

      hideMiniPlayer();

      // Hide home screen, show watch page
      document.getElementById('home-screen').classList.remove('visible');
      document.getElementById('watch-page').classList.add('visible');
      
      // Update watch page content
      updateWatchPage(video);
    }

    // Update watch page with video data
    function updateWatchPage(video) {
      // Update thumbnail
      document.getElementById('watch-thumbnail').src = video.videoThumbnail;
      
      // Update title
      document.getElementById('watch-title').textContent = video.videoTitle;
      
      // Update channel info
      const channelAvatar = document.getElementById('watch-channel-avatar');
      const channelName = document.getElementById('watch-channel-name');
      const authorAvatar = video.videoAuthorAvatar || video.videoAuthor.charAt(0).toUpperCase();
      const authorAvatarColor = video.videoAuthorAvatarColor || '#1a73e8';
      channelAvatar.textContent = authorAvatar;
      channelAvatar.style.background = authorAvatarColor;
      channelName.textContent = video.videoAuthor;
      
      // Update description
      const descriptionHeader = document.getElementById('watch-description-header');
      const descriptionText = document.getElementById('watch-description-text');
      descriptionHeader.textContent = `${formatViews(video.videoViews || 0)} • ${formatTimeAgo(video.videoPublishedAt)}`;
      descriptionText.textContent = video.videoDescription || 'Sem descrição';
      
      // Update like/dislike counts
      document.getElementById('watch-like-count').textContent = video.videoLikes || 0;
      document.getElementById('watch-dislike-count').textContent = video.videoDislikes || 0;
      
      // Update comment avatar
      const commentAvatar = document.getElementById('watch-comment-avatar');
      commentAvatar.textContent = currentUserAvatar;
      commentAvatar.style.background = currentUserAvatarColor;
      
      // Reset user interactions UI
      const videoKey = video.__backendId;
      if (!userInteractions[videoKey]) {
        userInteractions[videoKey] = { liked: false, disliked: false, subscribed: false };
      }
      
      const likeButton = document.getElementById('watch-like-button');
      const dislikeButton = document.getElementById('watch-dislike-button');
      const subscribeButton = document.getElementById('watch-subscribe-button');
      
      // Update like button
      if (userInteractions[videoKey].liked) {
        likeButton.classList.add('liked');
      } else {
        likeButton.classList.remove('liked');
      }
      
      // Update dislike button
      if (userInteractions[videoKey].disliked) {
        dislikeButton.classList.add('disliked');
      } else {
        dislikeButton.classList.remove('disliked');
      }
      
      // Update subscribe button
      if (userInteractions[videoKey].subscribed) {
        subscribeButton.textContent = 'Inscrito';
        subscribeButton.classList.add('subscribed');
      } else {
        subscribeButton.textContent = 'Inscrever-se';
        subscribeButton.classList.remove('subscribed');
      }
      
      // Render suggested videos (all videos except the current one)
      renderSuggestedVideos(video.__backendId);
    }

    // Render suggested videos
    function renderSuggestedVideos(currentVideoId) {
      const suggestedVideosContainer = document.getElementById('suggested-videos');
      
      // Get all videos except the current one
      let videos = allData.filter(item => item.videoTitle && item.__backendId !== currentVideoId);
      
      // Sort by published date (newest first)
      videos.sort((a, b) => new Date(b.videoPublishedAt) - new Date(a.videoPublishedAt));
      
      // Render suggested video cards
      suggestedVideosContainer.innerHTML = videos.map(video => `
        <div class="suggested-video-card" data-video-id="${video.__backendId}">
          <div class="suggested-thumbnail-container">
            <img src="${video.videoThumbnail}" alt="${video.videoTitle}">
            <div class="suggested-duration">${formatDuration(video.videoDuration)}</div>
          </div>
          <div class="suggested-video-info">
            <h3 class="suggested-video-title">${video.videoTitle}</h3>
            <div class="suggested-video-metadata">
              ${video.videoAuthor}<br>
              ${formatViews(video.videoViews || 0)}<br>
              ${formatTimeAgo(video.videoPublishedAt)}
            </div>
          </div>
        </div>
      `).join('');
      
      // Add click handlers to suggested video cards
      const suggestedCards = suggestedVideosContainer.querySelectorAll('.suggested-video-card');
      suggestedCards.forEach(card => {
        card.addEventListener('click', async () => {
          const videoId = card.dataset.videoId;
          const video = allData.find(item => item.__backendId === videoId);

          if (video) {
            // Incrementa visualizações com tolerância a falhas
            const updatedVideo = { ...video, videoViews: (video.videoViews || 0) + 1 };
            try {
              if (window.dataSdk?.update) {
                await window.dataSdk.update(updatedVideo);
              } else {
                persistLocalVideo(updatedVideo);
              }
            } catch (err) {
              console.error('Erro ao atualizar visualizações', err);
              persistLocalVideo(updatedVideo);
            }

            const index = allData.findIndex(item => item.__backendId === videoId);
            if (index !== -1) {
              allData[index] = updatedVideo;
            }

            currentWatchingVideo = updatedVideo;
            updateWatchPage(updatedVideo);
            renderVideos();
            document.getElementById('watch-page').scrollTop = 0;
          }
        });
      });
    }

    // Watch page interactions
    function setupWatchPageInteractions() {
      // Like button
      const likeButton = document.getElementById('watch-like-button');
      likeButton.addEventListener('click', async () => {
        if (!currentWatchingVideo) return;
        
        const videoKey = currentWatchingVideo.__backendId;
        const wasLiked = userInteractions[videoKey].liked;
        const wasDisliked = userInteractions[videoKey].disliked;
        
        let newLikes = currentWatchingVideo.videoLikes || 0;
        let newDislikes = currentWatchingVideo.videoDislikes || 0;
        
        if (wasLiked) {
          // Remove like
          newLikes = Math.max(0, newLikes - 1);
          userInteractions[videoKey].liked = false;
          likeButton.classList.remove('liked');
        } else {
          // Add like
          newLikes += 1;
          userInteractions[videoKey].liked = true;
          likeButton.classList.add('liked');
          
          // Remove dislike if present
          if (wasDisliked) {
            newDislikes = Math.max(0, newDislikes - 1);
            userInteractions[videoKey].disliked = false;
            document.getElementById('watch-dislike-button').classList.remove('disliked');
          }
        }
        
        // Update database
        const updatedVideo = { ...currentWatchingVideo, videoLikes: newLikes, videoDislikes: newDislikes };
        await window.dataSdk.update(updatedVideo);
        currentWatchingVideo = updatedVideo;
        
        // Update UI
        document.getElementById('watch-like-count').textContent = newLikes;
        document.getElementById('watch-dislike-count').textContent = newDislikes;
      });
      
      // Dislike button
      const dislikeButton = document.getElementById('watch-dislike-button');
      dislikeButton.addEventListener('click', async () => {
        if (!currentWatchingVideo) return;
        
        const videoKey = currentWatchingVideo.__backendId;
        const wasLiked = userInteractions[videoKey].liked;
        const wasDisliked = userInteractions[videoKey].disliked;
        
        let newLikes = currentWatchingVideo.videoLikes || 0;
        let newDislikes = currentWatchingVideo.videoDislikes || 0;
        
        if (wasDisliked) {
          // Remove dislike
          newDislikes = Math.max(0, newDislikes - 1);
          userInteractions[videoKey].disliked = false;
          dislikeButton.classList.remove('disliked');
        } else {
          // Add dislike
          newDislikes += 1;
          userInteractions[videoKey].disliked = true;
          dislikeButton.classList.add('disliked');
          
          // Remove like if present
          if (wasLiked) {
            newLikes = Math.max(0, newLikes - 1);
            userInteractions[videoKey].liked = false;
            document.getElementById('watch-like-button').classList.remove('liked');
          }
        }
        
        // Update database
        const updatedVideo = { ...currentWatchingVideo, videoLikes: newLikes, videoDislikes: newDislikes };
        await window.dataSdk.update(updatedVideo);
        currentWatchingVideo = updatedVideo;
        
        // Update UI
        document.getElementById('watch-like-count').textContent = newLikes;
        document.getElementById('watch-dislike-count').textContent = newDislikes;
      });
      
      // Subscribe button
      const subscribeButton = document.getElementById('watch-subscribe-button');
      subscribeButton.addEventListener('click', () => {
        if (!currentWatchingVideo) return;
        
        const videoKey = currentWatchingVideo.__backendId;
        
        if (userInteractions[videoKey].subscribed) {
          // Unsubscribe
          userInteractions[videoKey].subscribed = false;
          subscribeButton.textContent = 'Inscrever-se';
          subscribeButton.classList.remove('subscribed');
        } else {
          // Subscribe
          userInteractions[videoKey].subscribed = true;
          subscribeButton.textContent = 'Inscrito';
          subscribeButton.classList.add('subscribed');
        }
      });
      
      // Comment input
      const commentInput = document.getElementById('watch-comment-input');
      const commentCancel = document.getElementById('watch-comment-cancel');
      const commentSubmit = document.getElementById('watch-comment-submit');
      
      commentInput.addEventListener('input', () => {
        commentSubmit.disabled = commentInput.value.trim() === '';
      });
      
      commentCancel.addEventListener('click', () => {
        commentInput.value = '';
        commentInput.blur();
        commentSubmit.disabled = true;
      });
      
      commentSubmit.addEventListener('click', () => {
        // For now, just clear the input (comments are not functional yet)
        commentInput.value = '';
        commentSubmit.disabled = true;
      });
      
      // Logo click - return to home
      const headerLogo = document.querySelector('.header-logo');
      headerLogo.addEventListener('click', () => {
        document.getElementById('watch-page').classList.remove('visible');
        document.getElementById('home-screen').classList.add('visible');
        if (currentWatchingVideo) {
          showMiniPlayer(currentWatchingVideo);
        }
      });
    }

    setupWatchPageInteractions();

    const watchPageEl = document.getElementById('watch-page');
    if (watchPageEl) {
      watchPageEl.addEventListener('scroll', () => {
        if (watchPageEl.classList.contains('visible') && watchPageEl.scrollTop > 220) {
          showMiniPlayer(currentWatchingVideo);
        } else {
          hideMiniPlayer();
        }
      });
    }

    // Watch page header interactions (duplicate header)
    const watchMenuButton = document.getElementById('watch-menu-button');
    const watchHeaderLogo = document.getElementById('watch-header-logo');
    const watchCreateButton = document.getElementById('watch-create-button');
    const watchCreateDropdown = document.getElementById('watch-create-dropdown');
    const watchUploadVideo = document.getElementById('watch-upload-video');

    // Menu button in watch page
    if (watchMenuButton) {
      watchMenuButton.addEventListener('click', (e) => {
        e.stopPropagation();
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('visible');
      });
    }

    // Logo click in watch page - return to home
    if (watchHeaderLogo) {
      watchHeaderLogo.addEventListener('click', () => {
        document.getElementById('watch-page').classList.remove('visible');
        document.getElementById('home-screen').classList.add('visible');
        if (currentWatchingVideo) {
          showMiniPlayer(currentWatchingVideo);
        }
      });
    }

    // Create button dropdown in watch page
    if (watchCreateButton && watchCreateDropdown) {
      watchCreateButton.addEventListener('click', (e) => {
        e.stopPropagation();
        watchCreateDropdown.classList.toggle('visible');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (watchCreateButton && !watchCreateButton.contains(e.target) && !watchCreateDropdown.contains(e.target)) {
          watchCreateDropdown.classList.remove('visible');
        }
      });
    }

    // Upload video from watch page
    if (watchUploadVideo) {
      watchUploadVideo.addEventListener('click', () => {
        watchCreateDropdown.classList.remove('visible');
        uploadScreen.classList.add('visible');
      });
    }

    // Create dropdown functionality
    const createButton = document.getElementById('create-button');
    const createDropdown = document.getElementById('create-dropdown');
    const uploadScreen = document.getElementById('upload-screen');

    // Hero carousel interactions
    const heroSlides = document.querySelectorAll('.hero-slide');
    const heroDots = document.querySelectorAll('.hero-nav button');
    const heroUpload = document.getElementById('hero-upload');
    const heroExplore = document.getElementById('hero-explore');
    const insightSlides = document.querySelectorAll('.insight-slide');
    const insightDots = document.querySelectorAll('.insights-nav button');
    const categoriesSection = document.getElementById('categories-section');
    const experienceActions = document.querySelectorAll('.experience-card .experience-action');
    const experienceUpload = document.getElementById('map-start-upload');
    const experienceSignup = document.getElementById('map-start-signup');
    const experienceOverlay = document.getElementById('experience-overlay');
    const experienceOpeners = document.querySelectorAll('[data-open-experience]');
    const closeExperienceOverlay = document.getElementById('close-experience-overlay');
    const signupJourneyButton = document.getElementById('cta-signup-journey');
    const journeyPanel = document.getElementById('login-journey');
    const journeyToggle = document.getElementById('toggle-journey');
    const searchInputs = document.querySelectorAll('.search-input');
    const commentArea = document.querySelector('.comments-section');
    const miniPlayer = document.getElementById('mini-player');
    const miniThumbnail = document.getElementById('mini-thumbnail');
    const miniDuration = document.getElementById('mini-duration');
    const miniAvatar = document.getElementById('mini-avatar');
    const miniTitle = document.getElementById('mini-title');
    const miniMeta = document.getElementById('mini-meta');
    const miniClose = document.getElementById('mini-close');

    const showNavigationToast = (message, type = 'success') => {
      if (window.creatorFlow?.showToast) {
        window.creatorFlow.showToast(message, type === 'error' ? 'error' : 'success');
      } else {
        const fallbackContainer = document.getElementById('creator-toast-container');
        if (fallbackContainer) {
          const toast = document.createElement('div');
          toast.className = `toast ${type === 'error' ? 'error' : 'success'}`;
          toast.textContent = message;
          fallbackContainer.appendChild(toast);
          setTimeout(() => toast.remove(), 3200);
        } else {
          alert(message);
        }
      }
    };

    const ensureHomeVisible = () => {
      document.getElementById('watch-page').classList.remove('visible');
      document.getElementById('clips-page').classList.remove('visible');
      document.getElementById('home-screen').classList.add('visible');
    };

    const focusSearch = () => {
      const [firstSearch] = searchInputs;
      if (firstSearch) {
        firstSearch.focus();
        firstSearch.select?.();
      }
    };

    const openSignupFlow = () => {
      document.getElementById('home-screen')?.classList.remove('visible');
      document.getElementById('watch-page')?.classList.remove('visible');
      document.getElementById('clips-page')?.classList.remove('visible');
      document.querySelector('.login-wrapper')?.classList.add('visible');
      document.getElementById('login-screen')?.classList.add('hidden');
      document.getElementById('signup-screen')?.classList.remove('hidden');
    };

    const toggleExperienceOverlay = (shouldOpen = true) => {
      if (!experienceOverlay) return;

      experienceOverlay.classList.toggle('visible', shouldOpen);
      experienceOverlay.setAttribute('aria-hidden', shouldOpen ? 'false' : 'true');
      document.body.classList.toggle('modal-open', shouldOpen);

      if (shouldOpen) {
        const firstAction = experienceOverlay.querySelector('.experience-action');
        firstAction?.focus();
      }
    };

    if (journeyToggle && journeyPanel) {
      journeyToggle.addEventListener('click', () => {
        if (experienceOverlay) {
          toggleExperienceOverlay(true);
          journeyPanel.classList.add('collapsed');
          journeyToggle.setAttribute('aria-expanded', 'false');
          return;
        }

        const willExpand = journeyPanel.classList.contains('collapsed');
        journeyPanel.classList.toggle('collapsed');
        journeyToggle.setAttribute('aria-expanded', willExpand ? 'true' : 'false');
        journeyToggle.querySelector('span').textContent = willExpand
          ? 'Ocultar mapa de navegação do MTube'
          : 'Ver mapa de navegação do MTube';
      });
    }

    function navigateToSection(destination) {
      const hasVideos = allData.some(item => item.videoTitle);

      switch (destination) {
        case 'login': {
          document.querySelector('.login-wrapper')?.classList.add('visible');
          document.getElementById('home-screen')?.classList.remove('visible');
          document.getElementById('watch-page')?.classList.remove('visible');
          document.getElementById('clips-page')?.classList.remove('visible');
          document.getElementById('login-screen')?.classList.remove('hidden');
          document.getElementById('signup-screen')?.classList.add('hidden');
          break;
        }
        case 'home': {
          ensureHomeVisible();
          if (currentWatchingVideo) {
            showMiniPlayer(currentWatchingVideo);
          }
          break;
        }
        case 'upload': {
          ensureHomeVisible();
          uploadScreen?.classList.add('visible');
          window.creatorFlow?.setStep?.(1);
          break;
        }
        case 'watch': {
          const targetVideo = currentWatchingVideo || allData.find(item => item.videoTitle);
          if (!targetVideo) {
            showNavigationToast('Publique um vídeo para visualizar detalhes.', 'error');
            return;
          }
          openWatchPage(targetVideo.__backendId);
          break;
        }
        case 'clips': {
          if (!allData.some(item => item.videoType === 'clip')) {
            showNavigationToast('Adicione um clip para abrir a área de Clips.', 'error');
            return;
          }
          hideMiniPlayer();
          openClipsPage();
          break;
        }
        case 'categories': {
          if (!hasVideos) {
            showNavigationToast('Publique um vídeo para ativar as categorias.', 'error');
            return;
          }
          ensureHomeVisible();
          categoriesSection?.classList.remove('hidden');
          categoriesSection?.scrollIntoView({ behavior: 'smooth', block: 'center' });
          break;
        }
        case 'search': {
          ensureHomeVisible();
          focusSearch();
          break;
        }
        case 'comments': {
          const targetVideo = currentWatchingVideo || allData.find(item => item.videoTitle);
          if (!targetVideo) {
            showNavigationToast('Publique e abra um vídeo para ver os comentários.', 'error');
            return;
          }
          openWatchPage(targetVideo.__backendId);
          setTimeout(() => commentArea?.scrollIntoView({ behavior: 'smooth', block: 'start' }), 120);
          break;
        }
        default:
          break;
      }
    }

    function setHeroSlide(index) {
      if (heroSlides.length === 0) return;
      heroSlides.forEach(slide => slide.classList.remove('active'));
      heroDots.forEach(dot => dot.classList.remove('active'));

      const targetIndex = index % heroSlides.length;
      heroSlides[targetIndex].classList.add('active');
      if (heroDots[targetIndex]) {
        heroDots[targetIndex].classList.add('active');
      }
      heroInterval && clearTimeout(heroInterval);
      heroInterval = setTimeout(() => setHeroSlide(targetIndex + 1), 6000);
    }

    heroDots.forEach((dot, idx) => {
      dot.addEventListener('click', (e) => {
        e.stopPropagation();
        setHeroSlide(idx);
      });
    });

    setHeroSlide(0);

    function setInsightSlide(index) {
      if (insightSlides.length === 0) return;

      insightSlides.forEach(slide => slide.classList.remove('active'));
      insightDots.forEach(dot => dot.classList.remove('active'));

      const targetIndex = index % insightSlides.length;
      insightSlides[targetIndex].classList.add('active');
      insightDots[targetIndex]?.classList.add('active');

      insightInterval && clearTimeout(insightInterval);
      insightInterval = setTimeout(() => setInsightSlide(targetIndex + 1), 7000);
    }

    insightDots.forEach((dot, idx) => {
      dot.addEventListener('click', (e) => {
        e.stopPropagation();
        setInsightSlide(idx);
      });
    });

    if (insightSlides.length) {
      setInsightSlide(0);
    }

    if (heroUpload && uploadScreen) {
      heroUpload.addEventListener('click', () => {
        navigateToSection('upload');
      });
    }

    if (heroExplore && categoriesSection) {
      heroExplore.addEventListener('click', () => {
        navigateToSection('categories');
      });
    }

    experienceOpeners.forEach(btn => {
      btn.addEventListener('click', () => {
        toggleExperienceOverlay(true);
      });
    });

    if (closeExperienceOverlay) {
      closeExperienceOverlay.addEventListener('click', () => toggleExperienceOverlay(false));
    }

    if (experienceOverlay) {
      experienceOverlay.addEventListener('click', (e) => {
        if (e.target === experienceOverlay) {
          toggleExperienceOverlay(false);
        }
      });
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && experienceOverlay?.classList.contains('visible')) {
        toggleExperienceOverlay(false);
      }
    });

    experienceActions.forEach(btn => {
      btn.addEventListener('click', () => {
        if (experienceOverlay?.classList.contains('visible')) {
          toggleExperienceOverlay(false);
        }
        const target = btn.dataset.destination;
        navigateToSection(target);
      });
    });

    if (experienceUpload) {
      experienceUpload.addEventListener('click', () => navigateToSection('upload'));
    }

    if (experienceSignup) {
      experienceSignup.addEventListener('click', openSignupFlow);
    }

    if (signupJourneyButton) {
      signupJourneyButton.addEventListener('click', openSignupFlow);
    }

    function hideMiniPlayer() {
      miniPlayer?.classList.remove('visible');
    }

    function showMiniPlayer(video) {
      if (!miniPlayer || !video) return;

      const authorAvatar = video.videoAuthorAvatar || video.videoAuthor?.charAt(0).toUpperCase() || '?';
      const authorAvatarColor = video.videoAuthorAvatarColor || '#1a73e8';

      miniThumbnail.src = video.videoThumbnail || '';
      miniDuration.textContent = formatDuration(video.videoDuration || 0);
      miniAvatar.textContent = authorAvatar;
      miniAvatar.style.background = authorAvatarColor;
      miniTitle.textContent = video.videoTitle || 'Assistindo agora';
      miniMeta.textContent = `${video.videoAuthor || 'Canal'} • ${formatViews(video.videoViews || 0)}`;

      miniPlayer.classList.add('visible');
    }

    if (miniPlayer) {
      miniPlayer.addEventListener('click', (e) => {
        if (e.target === miniClose) return;
        if (currentWatchingVideo) {
          openWatchPage(currentWatchingVideo.__backendId);
        }
      });
    }

    if (miniClose) {
      miniClose.addEventListener('click', (e) => {
        e.stopPropagation();
        hideMiniPlayer();
      });
    }

    if (createButton && createDropdown) {
      createButton.addEventListener('click', (e) => {
        e.stopPropagation();
        createDropdown.classList.toggle('visible');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!createButton.contains(e.target) && !createDropdown.contains(e.target)) {
          createDropdown.classList.remove('visible');
        }
      });

      // Close dropdown when clicking a dropdown item
      const dropdownItems = createDropdown.querySelectorAll('.create-dropdown-item');
      dropdownItems.forEach(item => {
        item.addEventListener('click', () => {
          createDropdown.classList.remove('visible');
          uploadScreen.classList.add('visible');
        });
      });
    }

    // Upload screen functionality
    let selectedThumbnailUrl = null;
    let selectedVideoType = 'video';

    // Load thumbnails using Picsum with varied images
    function loadThumbnails() {
      const thumbnailGrid = document.getElementById('thumbnail-grid');
      thumbnailGrid.innerHTML = '';
      
      // Using Picsum with different seed values for variety
      const thumbnailSeeds = [
        'nature', 'technology', 'abstract', 'architecture', 'people',
        'animals', 'food', 'travel', 'sunset', 'ocean',
        'mountains', 'city', 'flowers', 'space', 'art',
        'music', 'sports', 'business', 'education', 'health',
        'fashion', 'design', 'coding', 'gaming', 'fitness',
        'science', 'history', 'culture', 'forest', 'desert',
        'beach', 'skyline', 'vintage', 'modern', 'colorful',
        'minimalist', 'landscape', 'portrait', 'street', 'wildlife'
      ];

      thumbnailSeeds.forEach((seed, index) => {
        const thumbnailItem = document.createElement('div');
        thumbnailItem.className = 'thumbnail-item';
        const imgUrl = `https://picsum.photos/seed/${seed}/300/169`;
        thumbnailItem.dataset.thumbnailUrl = imgUrl;
        
        const img = document.createElement('img');
        img.src = imgUrl;
        img.alt = `Thumbnail ${index + 1}`;
        
        // Handle image load errors
        img.onerror = function() {
          this.src = `https://picsum.photos/300/169?random=${index}`;
          this.alt = 'Thumbnail alternativa';
        };
        
        const checkmark = document.createElement('div');
        checkmark.className = 'thumbnail-checkmark';
        checkmark.innerHTML = '✓';
        
        thumbnailItem.appendChild(img);
        thumbnailItem.appendChild(checkmark);
        
        thumbnailItem.addEventListener('click', () => {
          document.querySelectorAll('.thumbnail-item').forEach(item => {
            item.classList.remove('selected');
          });
          thumbnailItem.classList.add('selected');
          selectedThumbnailUrl = imgUrl;
          
          // Update preview
          const preview = document.getElementById('selected-thumbnail-preview');
          const placeholder = document.getElementById('thumbnail-placeholder');
          preview.src = imgUrl;
          preview.classList.remove('hidden');
          placeholder.classList.add('hidden');
          window.selectedThumbnailUrl = imgUrl;

          // Close modal
          document.getElementById('thumbnail-modal').classList.remove('visible');

          if (window.creatorFlow) {
            window.creatorFlow.setStep(2);
          }

          validateForm();
        });
        
        thumbnailGrid.appendChild(thumbnailItem);
      });
    }

    // Explore thumbnails button
    const exploreThumbnailsButton = document.getElementById('explore-thumbnails-button');
    const thumbnailModal = document.getElementById('thumbnail-modal');
    const closeThumbnailModal = document.getElementById('close-thumbnail-modal');

    if (exploreThumbnailsButton) {
      exploreThumbnailsButton.addEventListener('click', () => {
        thumbnailModal.classList.add('visible');
        if (document.getElementById('thumbnail-grid').children.length === 0) {
          loadThumbnails();
        }
      });
    }

    if (closeThumbnailModal) {
      closeThumbnailModal.addEventListener('click', () => {
        thumbnailModal.classList.remove('visible');
      });
    }

    // Video type selection
    const videoTypeVideo = document.getElementById('video-type-video');
    const videoTypeClip = document.getElementById('video-type-clip');

    if (videoTypeVideo && videoTypeClip) {
      videoTypeVideo.addEventListener('click', () => {
        if (!videoTypeVideo.classList.contains('disabled')) {
          videoTypeVideo.classList.add('selected');
          videoTypeClip.classList.remove('selected');
          selectedVideoType = 'video';
        }
      });

      videoTypeClip.addEventListener('click', () => {
        if (!videoTypeClip.classList.contains('disabled')) {
          videoTypeClip.classList.add('selected');
          videoTypeVideo.classList.remove('selected');
          selectedVideoType = 'clip';
        }
      });
    }

    // Duration validation
    const durationMinutes = document.getElementById('duration-minutes');
    const durationSeconds = document.getElementById('duration-seconds');

    function checkDuration() {
      const minutes = parseInt(durationMinutes.value) || 0;
      const seconds = parseInt(durationSeconds.value) || 0;
      const totalSeconds = minutes * 60 + seconds;

      if (totalSeconds > 60) {
        videoTypeClip.classList.add('disabled');
        if (selectedVideoType === 'clip') {
          videoTypeClip.classList.remove('selected');
          videoTypeVideo.classList.add('selected');
          selectedVideoType = 'video';
        }
      } else {
        videoTypeClip.classList.remove('disabled');
      }

      validateForm();
    }

    if (durationMinutes && durationSeconds) {
      durationMinutes.addEventListener('input', checkDuration);
      durationSeconds.addEventListener('input', () => {
        const value = parseInt(durationSeconds.value) || 0;
        if (value > 59) {
          durationSeconds.value = 59;
        }
        checkDuration();
      });
    }

    // Form validation
    function validateForm() {
      const title = document.getElementById('video-title').value.trim();
      const category = document.getElementById('video-category').value;
      const minutes = parseInt(durationMinutes.value) || 0;
      const seconds = parseInt(durationSeconds.value) || 0;
      const totalSeconds = minutes * 60 + seconds;
      const publishButton = document.getElementById('publish-button');
      const thumbnailUrl = window.selectedThumbnailUrl || selectedThumbnailUrl;

      selectedThumbnailUrl = thumbnailUrl;

      const isValid = title && thumbnailUrl && totalSeconds > 0 && category;
      publishButton.disabled = !isValid;
    }

    const videoTitle = document.getElementById('video-title');
    const videoCategory = document.getElementById('video-category');
    if (videoTitle) {
      videoTitle.addEventListener('input', validateForm);
    }
    if (videoCategory) {
      videoCategory.addEventListener('change', validateForm);
    }

    // Close upload screen
    const closeUploadButton = document.getElementById('close-upload');
    const cancelUploadButton = document.getElementById('cancel-upload');

    function closeUploadScreen() {
      uploadScreen.classList.remove('visible');
      document.getElementById('upload-form').reset();
      selectedThumbnailUrl = null;
      selectedVideoType = 'video';

      if (window.creatorFlow) {
        window.creatorFlow.reset();
      }

      // Reset thumbnail preview
      const preview = document.getElementById('selected-thumbnail-preview');
      const placeholder = document.getElementById('thumbnail-placeholder');
      preview.classList.add('hidden');
      placeholder.classList.remove('hidden');

      document.querySelectorAll('.thumbnail-item').forEach(item => {
        item.classList.remove('selected');
      });
      videoTypeVideo.classList.add('selected');
      videoTypeClip.classList.remove('selected');
      videoTypeClip.classList.remove('disabled');
      validateForm();
    }

    if (closeUploadButton) {
      closeUploadButton.addEventListener('click', closeUploadScreen);
    }

    if (cancelUploadButton) {
      cancelUploadButton.addEventListener('click', closeUploadScreen);
    }

    // Publish button
    const publishButton = document.getElementById('publish-button');
    if (publishButton) {
      publishButton.addEventListener('click', async (e) => {
        e.preventDefault();

        const title = document.getElementById('video-title').value.trim();
        const description = document.getElementById('video-description').value.trim();
        const category = document.getElementById('video-category').value;
        const minutes = parseInt(durationMinutes.value) || 0;
        const seconds = parseInt(durationSeconds.value) || 0;
        const totalSeconds = minutes * 60 + seconds;
        const thumbnailUrl = window.selectedThumbnailUrl || selectedThumbnailUrl;

        const localBackendId = (typeof crypto !== 'undefined' && crypto.randomUUID)
          ? crypto.randomUUID()
          : `vid-${Date.now()}-${Math.random().toString(16).slice(2)}`;

        const newVideo = {
          __backendId: localBackendId,
          videoTitle: title,
          videoDescription: description,
          videoThumbnail: thumbnailUrl,
          videoDuration: totalSeconds,
          videoType: selectedVideoType,
          videoCategory: category,
          videoAuthor: currentUsername,
          videoAuthorAvatar: currentUserAvatar,
          videoAuthorAvatarColor: currentUserAvatarColor,
          videoViews: 0,
          videoPublishedAt: new Date().toISOString()
        };

        try {
          if (window.creatorFlow) {
            window.creatorFlow.setStep(3);
            window.creatorFlow.setLoading(true, 'Publicando...');
          } else {
            publishButton.disabled = true;
            publishButton.textContent = 'Publicando...';
          }

          const savedVideo = await persistVideo(newVideo);
          allData = [...allData, savedVideo];
          renderVideos();
          closeUploadScreen();
          if (window.creatorFlow) {
            window.creatorFlow.showToast('Vídeo publicado com sucesso!', 'success');
          }
        } catch (error) {
          console.error(error);
          const uploadContent = document.querySelector('.upload-content');
          const errorMessage = document.createElement('div');
          errorMessage.className = 'message error';
          errorMessage.textContent = 'Erro ao publicar vídeo. Tente novamente.';
          errorMessage.style.marginBottom = '16px';
          uploadContent.insertBefore(errorMessage, uploadContent.firstChild);

          setTimeout(() => {
            errorMessage.remove();
          }, 4000);

          if (window.creatorFlow) {
            window.creatorFlow.showToast('Erro ao publicar vídeo. Tente novamente.', 'error');
          }
        } finally {
          if (window.creatorFlow) {
            window.creatorFlow.setLoading(false);
          } else {
            publishButton.disabled = false;
            publishButton.textContent = 'Publicar';
          }
        }
      });
    }

    // Signup form
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('signup-username').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      const confirm = document.getElementById('signup-confirm').value;
      const messageContainer = document.getElementById('message-container');
      const submitButton = document.getElementById('signup-button-text');

      messageContainer.innerHTML = '';

      if (password !== confirm) {
        messageContainer.innerHTML = '<div class="message error">As senhas não coincidem!</div>';
        return;
      }

      if (password.length < 6) {
        messageContainer.innerHTML = '<div class="message error">A senha deve ter pelo menos 6 caracteres!</div>';
        return;
      }

      submitButton.disabled = true;
      submitButton.textContent = 'Criando...';

      const newUser = {
        username: username,
        email: email,
        password: password,
        createdAt: new Date().toISOString()
      };

      const result = await window.dataSdk.create(newUser);

      if (result.isOk) {
        // Clear signup form
        document.getElementById('signup-form').reset();
        messageContainer.innerHTML = '';
        
        // Return to login screen immediately
        document.getElementById('signup-screen').classList.add('hidden');
        document.getElementById('login-screen').classList.remove('hidden');
        
        // Show success message on login screen
        const loginContainer = document.querySelector('.login-container');
        const successMessage = document.createElement('div');
        successMessage.className = 'message success';
        successMessage.textContent = 'Conta criada com sucesso! Faça login para continuar.';
        successMessage.style.marginBottom = '16px';
        loginContainer.insertBefore(successMessage, document.getElementById('login-screen'));
        
        // Remove success message after 4 seconds
        setTimeout(() => {
          successMessage.remove();
        }, 4000);
      } else {
        messageContainer.innerHTML = '<div class="message error">Erro ao criar conta. Tente novamente.</div>';
      }

      submitButton.disabled = false;
      submitButton.textContent = 'Criar conta';
    });

    // Clips functionality
    let clipInteractions = {}; // Store likes, dislikes, subscriptions per clip
    let currentClipIndex = 0;
    let clipsData = [];

    function openClipsPage() {
      // Get all clips
      clipsData = allData.filter(item => item.videoTitle && item.videoType === 'clip');
      
      if (clipsData.length === 0) {
        // No clips available - show message
        return;
      }
      
      // Shuffle clips for random order
      clipsData = shuffleArray([...clipsData]);
      
      // Hide other screens
      document.getElementById('home-screen').classList.remove('visible');
      document.getElementById('watch-page').classList.remove('visible');
      
      // Show clips page
      document.getElementById('clips-page').classList.add('visible');
      
      // Render clips
      renderClips();
      
      // Reset to first clip
      currentClipIndex = 0;
      const clipsContainer = document.getElementById('clips-container');
      clipsContainer.scrollTop = 0;
    }

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function renderClips() {
      const clipsContainer = document.getElementById('clips-container');
      
      clipsContainer.innerHTML = clipsData.map((clip, index) => {
        const clipKey = clip.__backendId;
        if (!clipInteractions[clipKey]) {
          clipInteractions[clipKey] = { liked: false, disliked: false, subscribed: false };
        }
        
        const authorAvatar = clip.videoAuthorAvatar || clip.videoAuthor.charAt(0).toUpperCase();
        const authorAvatarColor = clip.videoAuthorAvatarColor || '#1a73e8';
        
        return `
          <div class="clip-item" data-clip-index="${index}" data-clip-id="${clip.__backendId}">
            <div class="clip-video-container">
              <img class="clip-thumbnail" src="${clip.videoThumbnail}" alt="${clip.videoTitle}">
              <div class="clip-unavailable-overlay">
                O vídeo não está disponível por causa de limitações do site
              </div>
            </div>
            
            <!-- Clip Info -->
            <div class="clip-info">
              <div class="clip-author-section">
                <div class="clip-author-avatar" style="background: ${authorAvatarColor};">${authorAvatar}</div>
                <div class="clip-author-info">
                  <div class="clip-author-name">${clip.videoAuthor}</div>
                </div>
                <button class="clip-subscribe-button ${clipInteractions[clipKey].subscribed ? 'subscribed' : ''}" data-clip-id="${clip.__backendId}">
                  ${clipInteractions[clipKey].subscribed ? 'Inscrito' : 'Inscrever-se'}
                </button>
              </div>
              <div class="clip-title">${clip.videoTitle}</div>
            </div>
            
            <!-- Clip Actions -->
            <div class="clip-sidebar">
              <button class="clip-action-button ${clipInteractions[clipKey].liked ? 'active' : ''}" data-action="like" data-clip-id="${clip.__backendId}">
                <div class="clip-action-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="${clipInteractions[clipKey].liked ? 'currentColor' : 'none'}">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="clip-action-count">${clip.videoLikes || 0}</span>
              </button>
              
              <button class="clip-action-button ${clipInteractions[clipKey].disliked ? 'active' : ''}" data-action="dislike" data-clip-id="${clip.__backendId}">
                <div class="clip-action-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="clip-action-count">${clip.videoDislikes || 0}</span>
              </button>
              
              <button class="clip-action-button" data-action="comment" data-clip-id="${clip.__backendId}">
                <div class="clip-action-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <span class="clip-action-count">0</span>
              </button>
            </div>
            
            ${index === 0 ? '<div class="clip-navigation-hint"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M19 12l-7 7-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Deslize para ver mais</div>' : ''}
          </div>
        `;
      }).join('');
      
      // Setup clip interactions
      setupClipInteractions();
    }

    function setupClipInteractions() {
      // Subscribe buttons
      const subscribeButtons = document.querySelectorAll('.clip-subscribe-button');
      subscribeButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const clipId = button.dataset.clipId;
          
          if (clipInteractions[clipId].subscribed) {
            clipInteractions[clipId].subscribed = false;
            button.textContent = 'Inscrever-se';
            button.classList.remove('subscribed');
          } else {
            clipInteractions[clipId].subscribed = true;
            button.textContent = 'Inscrito';
            button.classList.add('subscribed');
          }
        });
      });
      
      // Action buttons (like, dislike, comment)
      const actionButtons = document.querySelectorAll('.clip-action-button');
      actionButtons.forEach(button => {
        button.addEventListener('click', async (e) => {
          e.stopPropagation();
          const action = button.dataset.action;
          const clipId = button.dataset.clipId;
          
          if (action === 'comment') {
            // Open comment modal
            document.getElementById('clip-comment-modal').classList.add('visible');
            const clipCommentAvatar = document.getElementById('clip-comment-avatar');
            clipCommentAvatar.textContent = currentUserAvatar;
            clipCommentAvatar.style.background = currentUserAvatarColor;
            return;
          }
          
          const clip = clipsData.find(c => c.__backendId === clipId);
          if (!clip) return;
          
          let newLikes = clip.videoLikes || 0;
          let newDislikes = clip.videoDislikes || 0;
          
          if (action === 'like') {
            const wasLiked = clipInteractions[clipId].liked;
            const wasDisliked = clipInteractions[clipId].disliked;
            
            if (wasLiked) {
              newLikes = Math.max(0, newLikes - 1);
              clipInteractions[clipId].liked = false;
              button.classList.remove('active');
              button.querySelector('svg path').setAttribute('fill', 'none');
            } else {
              newLikes += 1;
              clipInteractions[clipId].liked = true;
              button.classList.add('active');
              button.querySelector('svg path').setAttribute('fill', 'currentColor');
              
              if (wasDisliked) {
                newDislikes = Math.max(0, newDislikes - 1);
                clipInteractions[clipId].disliked = false;
                const dislikeButton = document.querySelector(`[data-action="dislike"][data-clip-id="${clipId}"]`);
                dislikeButton.classList.remove('active');
              }
            }
          } else if (action === 'dislike') {
            const wasLiked = clipInteractions[clipId].liked;
            const wasDisliked = clipInteractions[clipId].disliked;
            
            if (wasDisliked) {
              newDislikes = Math.max(0, newDislikes - 1);
              clipInteractions[clipId].disliked = false;
              button.classList.remove('active');
            } else {
              newDislikes += 1;
              clipInteractions[clipId].disliked = true;
              button.classList.add('active');
              
              if (wasLiked) {
                newLikes = Math.max(0, newLikes - 1);
                clipInteractions[clipId].liked = false;
                const likeButton = document.querySelector(`[data-action="like"][data-clip-id="${clipId}"]`);
                likeButton.classList.remove('active');
                likeButton.querySelector('svg path').setAttribute('fill', 'none');
              }
            }
          }
          
          // Update database
          const updatedClip = { ...clip, videoLikes: newLikes, videoDislikes: newDislikes };
          await window.dataSdk.update(updatedClip);
          
          // Update local data
          const clipIndex = clipsData.findIndex(c => c.__backendId === clipId);
          if (clipIndex !== -1) {
            clipsData[clipIndex] = updatedClip;
          }
          
          // Update UI
          button.querySelector('.clip-action-count').textContent = action === 'like' ? newLikes : newDislikes;
        });
      });
    }

    // Clips back button
    const clipsBackButton = document.getElementById('clips-back-button');
    if (clipsBackButton) {
      clipsBackButton.addEventListener('click', () => {
        document.getElementById('clips-page').classList.remove('visible');
        document.getElementById('home-screen').classList.add('visible');
      });
    }

    // Clip comment modal
    const clipCommentModal = document.getElementById('clip-comment-modal');
    const clipCommentClose = document.getElementById('clip-comment-close');
    const clipCommentInput = document.getElementById('clip-comment-input');
    const clipCommentSend = document.getElementById('clip-comment-send');

    if (clipCommentClose) {
      clipCommentClose.addEventListener('click', () => {
        clipCommentModal.classList.remove('visible');
        clipCommentInput.value = '';
        clipCommentSend.disabled = true;
      });
    }

    if (clipCommentInput) {
      clipCommentInput.addEventListener('input', () => {
        clipCommentSend.disabled = clipCommentInput.value.trim() === '';
      });
    }

    if (clipCommentSend) {
      clipCommentSend.addEventListener('click', () => {
        clipCommentInput.value = '';
        clipCommentSend.disabled = true;
      });
    }
  </script>
  <script>
    // Fluxo de criação com stepper, seletor, botões e toasts
    document.addEventListener('DOMContentLoaded', () => {
      const stepperSteps = Array.from(document.querySelectorAll('#creator-stepper .creator-step'));
      const form = document.getElementById('upload-form');
      const thumbnailPreviewImg = document.getElementById('selected-thumbnail-preview');
      const thumbnailPlaceholder = document.getElementById('thumbnail-placeholder');
      const thumbnailPlaceholderText = document.getElementById('thumbnail-placeholder-text');
      const draftButton = document.getElementById('draft-flow-button');
      const publishButton = document.getElementById('publish-button');
      const cancelButton = document.getElementById('cancel-upload');
      const loadingLabel = document.getElementById('creator-loading-label');
      const loadingText = document.getElementById('creator-loading-text');
      const toastContainer = document.getElementById('creator-toast-container');

      if (!form) return;

      const setStep = (step) => {
        stepperSteps.forEach((item) => {
          const stepNumber = Number(item.dataset.step);
          item.classList.toggle('active', stepNumber === step);
          item.classList.toggle('completed', stepNumber < step);
        });
      };

      const showToast = (message, type = 'success') => {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<span>${message}</span>`;
        toastContainer.appendChild(toast);
        setTimeout(() => toast.remove(), 3800);
      };

      const setLoading = (isLoading, text = 'Processando...') => {
        [draftButton, publishButton, cancelButton].forEach((btn) => {
          if (btn) btn.disabled = isLoading;
        });
        if (loadingLabel) loadingLabel.classList.toggle('visible', isLoading);
        if (loadingText) loadingText.textContent = text;
      };

      const resetForm = () => {
        if (form) form.reset();
        if (thumbnailPreviewImg) {
          thumbnailPreviewImg.src = '';
          thumbnailPreviewImg.classList.add('hidden');
        }
        if (thumbnailPlaceholder) thumbnailPlaceholder.classList.remove('hidden');
        if (thumbnailPlaceholderText) thumbnailPlaceholderText.textContent = 'Escolha uma capa diretamente da galeria.';
        window.selectedThumbnailUrl = null;
        setStep(1);
        setLoading(false);
      };

      if (draftButton) {
        draftButton.addEventListener('click', () => {
          setLoading(true, 'Salvando rascunho...');
          setStep(1);
          setTimeout(() => {
            setLoading(false);
            showToast('Rascunho salvo com sucesso.', 'success');
          }, 1400);
        });
      }

      window.creatorFlow = {
        setStep,
        showToast,
        setLoading,
        reset: resetForm,
      };

      if (cancelButton) {
        cancelButton.addEventListener('click', () => {
          resetForm();
          showToast('Fluxo cancelado e limpo.', 'success');
        });
      }
    });
  </script>
  <script>
  // Custom local user storage and login/sign-up logic.
  // Utility to compute SHA-256 hash for password encryption.
  async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');
  }
  // Load existing users from localStorage or use an empty array.
  let storedUsers = JSON.parse(localStorage.getItem('users') || '[]');
  // Override sign‑up behaviour: store user locally and enforce basic validation.
  document.getElementById('signup-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    e.stopImmediatePropagation();
    const username = document.getElementById('signup-username').value.trim();
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value;
    const confirm = document.getElementById('signup-confirm').value;
    const messageContainer = document.getElementById('message-container');
    const submitButton = document.getElementById('signup-button-text');
    messageContainer.innerHTML = '';
    // Validate password confirmation and length.
    if (password !== confirm) {
      messageContainer.innerHTML = '<div class="message error">As senhas não coincidem!</div>';
      return;
    }
    if (password.length < 6) {
      messageContainer.innerHTML = '<div class="message error">A senha deve ter pelo menos 6 caracteres!</div>';
      return;
    }
    submitButton.disabled = true;
    submitButton.textContent = 'Criando...';
    // Prevent duplicate usernames.
    if (storedUsers.find((u) => u.username === username)) {
      messageContainer.innerHTML = '<div class="message error">Nome de usuário já existe!</div>';
      submitButton.disabled = false;
      submitButton.textContent = 'Criar conta';
      return;
    }
    // Hash the password before storing.
    const hashed = await hashPassword(password);
    const newUser = {
      username: username,
      email: email,
      password: hashed,
      createdAt: new Date().toISOString(),
    };
    storedUsers.push(newUser);
    localStorage.setItem('users', JSON.stringify(storedUsers));
    allData.push(newUser);
    document.getElementById('signup-form').reset();
    // Go back to login screen and show success message.
    document.getElementById('signup-screen').classList.add('hidden');
    document.getElementById('login-screen').classList.remove('hidden');
    const loginContainer = document.querySelector('.login-container');
    const successMessage = document.createElement('div');
    successMessage.className = 'message success';
    successMessage.textContent = 'Conta criada com sucesso! Faça login para continuar.';
    successMessage.style.marginBottom = '16px';
    loginContainer.insertBefore(successMessage, document.getElementById('login-screen'));
    setTimeout(() => {
      successMessage.remove();
    }, 4000);
    submitButton.disabled = false;
    submitButton.textContent = 'Criar conta';
  });
  // Override login behaviour: check hashed password against stored users.
  document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    e.stopImmediatePropagation();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const rememberCheckbox = document.getElementById('remember');
    const loginContainer = document.querySelector('.login-container');
    // Remove existing error messages if any.
    const existingError = loginContainer.querySelector('.message.error');
    if (existingError) {
      existingError.remove();
    }
    const hashed = await hashPassword(password);
    const userExists = storedUsers.find((u) => u.username === username && u.password === hashed);
    if (!userExists) {
      const errorMessage = document.createElement('div');
      errorMessage.className = 'message error';
      errorMessage.textContent = 'Usuário ou senha inválidos!';
      errorMessage.style.marginBottom = '16px';
      loginContainer.insertBefore(errorMessage, document.getElementById('login-screen'));
      setTimeout(() => {
        errorMessage.remove();
      }, 4000);
      return;
    }
    currentUsername = username;
    currentUserAvatar = userExists.userAvatar || username.charAt(0).toUpperCase();
    currentUserAvatarColor = userExists.userAvatarColor || '#1a73e8';
    if (rememberCheckbox.checked) {
      localStorage.setItem('rememberMe', 'true');
      localStorage.setItem('savedUsername', username);
    } else {
      localStorage.removeItem('rememberMe');
      localStorage.removeItem('savedUsername');
    }
    document.querySelector('.login-wrapper').classList.remove('visible');
    document.getElementById('home-screen').classList.add('visible');
    setTimeout(() => renderVideos(), 100);
  });
  </script>
  <script>
    // Camada de experiência avançada do MTube: PWA, pré-carregamento, notificações e testes rápidos
    (function mtubeAppShell() {
      const TEMPO_NOTIFICACAO_MS = 90000;
      let notificacaoInterval = null;

      function registrarServiceWorker() {
        if (!('serviceWorker' in navigator)) return;

        const swScript = `
          const CACHE_NAME = 'mtube-clips-offline-v1';
          self.addEventListener('install', (event) => {self.skipWaiting();});
          self.addEventListener('activate', (event) => {event.waitUntil(self.clients.claim());});
          self.addEventListener('message', (event) => {
            if (event.data?.type === 'cache-clip' && event.data.url) {
              event.waitUntil(caches.open(CACHE_NAME).then((cache) => cache.add(event.data.url)));
            }
          });
          self.addEventListener('fetch', (event) => {
            if (event.request.method !== 'GET') return;
            event.respondWith(
              caches.match(event.request).then((cached) => {
                if (cached) return cached;
                return fetch(event.request).then((response) => {
                  if (event.request.url.includes('/clips/')) {
                    const clone = response.clone();
                    caches.open(CACHE_NAME).then((cache) => cache.put(event.request, clone));
                  }
                  return response;
                });
              })
            );
          });
        `;

        const blob = new Blob([swScript], { type: 'text/javascript' });
        const swUrl = URL.createObjectURL(blob);

        navigator.serviceWorker.register(swUrl).catch((error) => {
          console.warn('SW falhou, mas a navegação continua.', error);
        });
      }

      function cacheClipesVisiveis() {
        if (!navigator.serviceWorker?.controller) return;
        const thumbs = document.querySelectorAll('.clip-thumbnail');
        thumbs.forEach((img) => {
          navigator.serviceWorker.controller.postMessage({ type: 'cache-clip', url: img.src });
        });
      }

      function preCarregarHome() {
        const executor = () => {
          if (typeof loadLocalVideos === 'function') loadLocalVideos();
          if (typeof renderVideos === 'function') renderVideos();
          if (typeof renderClips === 'function') renderClips();
          cacheClipesVisiveis();
        };

        if ('requestIdleCallback' in window) {
          requestIdleCallback(executor, { timeout: 1200 });
        } else {
          setTimeout(executor, 150);
        }
      }

      function gerarVideoAoVivoFake() {
        const agora = Date.now();
        const id = `rt-${agora}`;
        const autor = currentUsername || 'Convidado';
        return {
          __backendId: id,
          videoTitle: `Ao vivo relâmpago #${new Date().toLocaleTimeString('pt-BR')}`,
          videoThumbnail: 'https://images.unsplash.com/photo-1464375117522-1311d6a5b81f?auto=format&fit=crop&w=800&q=60',
          videoDuration: 420,
          videoViews: 0,
          videoAuthor: autor,
          videoAuthorAvatar: autor.charAt(0).toUpperCase(),
          videoAuthorAvatarColor: '#0f172a',
          videoPublishedAt: new Date().toISOString(),
          videoCategory: 'Entretenimento',
          videoType: 'live'
        };
      }

      function iniciarNotificacoesTempoReal() {
        const botaoCampainha = document.querySelector('.notification-button');
        if (!botaoCampainha) return;

        const emitir = () => {
          const novoVideo = gerarVideoAoVivoFake();
          const jaExiste = allData.some((item) => item.__backendId === novoVideo.__backendId);
          if (jaExiste) return;
          allData.push(novoVideo);
          persistLocalVideo(novoVideo);
          renderVideos();
          if (typeof showToast === 'function') {
            showToast('Novo vídeo chegou em tempo real.', 'success');
          }
          if (botaoCampainha && !botaoCampainha.classList.contains('active')) {
            botaoCampainha.classList.add('active');
            botaoCampainha.setAttribute('aria-pressed', 'true');
          }
        };

        notificacaoInterval = setInterval(emitir, TEMPO_NOTIFICACAO_MS);
        botaoCampainha.addEventListener('click', () => {
          botaoCampainha.classList.remove('active');
          botaoCampainha.setAttribute('aria-pressed', 'false');
        });
      }

      function prepararPushBasico() {
        if (!('Notification' in window)) return;
        if (Notification.permission === 'default') {
          Notification.requestPermission().catch(() => {});
        }
      }

      function registrarTestesDeInterface() {
        // Pequena suíte estilo Jest para validar elementos críticos sem dependências externas
        const resultados = [];
        const assert = (descricao, condicao) => {
          resultados.push({ descricao, passou: Boolean(condicao) });
        };

        assert('Login visível na carga inicial', document.querySelector('.login-wrapper'));
        assert('Home existe para navegação', document.getElementById('home-screen'));
        assert('Formulário de upload existe', document.getElementById('upload-modal'));
        assert('Grade de vídeos presente', document.getElementById('videos-grid'));
        assert('Área de comentários existe', document.getElementById('comments-section'));

        console.groupCollapsed('Testes automatizados de interface (modo leve)');
        resultados.forEach((resultado) => {
          const status = resultado.passou ? '✅' : '❌';
          console.log(`${status} ${resultado.descricao}`);
        });
        console.groupEnd();
      }

      function inicializar() {
        registrarServiceWorker();
        prepararPushBasico();
        preCarregarHome();
        iniciarNotificacoesTempoReal();
        registrarTestesDeInterface();
      }

      document.addEventListener('visibilitychange', () => {
        if (document.hidden && notificacaoInterval) {
          clearInterval(notificacaoInterval);
          notificacaoInterval = null;
        } else if (!document.hidden && !notificacaoInterval) {
          iniciarNotificacoesTempoReal();
        }
      });

      window.addEventListener('beforeunload', () => {
        if (notificacaoInterval) clearInterval(notificacaoInterval);
      });

      // Aguarda a aplicação existente subir antes de conectar camadas novas
      window.addEventListener('load', () => {
        inicializar();
      });
    })();
  </script>
  <script>
    // Blueprint de backend: descreve como o servidor do MTube deve operar em produção.
    // Mantemos aqui para alinhar a interface com a futura camada real de APIs e microsserviços.
    (function desenharArquiteturaDeServidor() {
      const servicos = {
        identidade: {
          nome: 'identity-service',
          proposito: 'Autenticação, autorização, emissão e rotação de tokens JWT',
          endpoints: [
            { metodo: 'POST', rota: '/api/auth/login', descricao: 'Autentica e retorna token + refresh' },
            { metodo: 'POST', rota: '/api/auth/refresh', descricao: 'Renova token e reforça sessão segura' },
            { metodo: 'POST', rota: '/api/auth/logout', descricao: 'Revoga sessão e limpa refresh token' }
          ],
          seguranca: ['Argon2 para hash', 'MFA opcional', 'IP/device binding']
        },
        videos: {
          nome: 'video-service',
          proposito: 'Upload, metadados, streaming adaptativo (HLS/DASH) e transcodificação assíncrona',
          endpoints: [
            { metodo: 'POST', rota: '/api/videos', descricao: 'Cria vídeo e agenda transcodificação' },
            { metodo: 'GET', rota: '/api/videos/:id', descricao: 'Recupera metadados, URLs de CDN e legendas' },
            { metodo: 'PATCH', rota: '/api/videos/:id', descricao: 'Atualiza título, categoria e privacidade' }
          ],
          pipelines: {
            ingestao: 'Upload direto para storage + fila SQS/Kafka',
            transcodificacao: 'Worker dedicado + serviço isolado para jobs pesados',
            distribuicao: 'CDN para thumbnails e segmentos .ts/.m4s'
          }
        },
        categorias: {
          nome: 'category-service',
          proposito: 'CRUD de categorias e taxonomias editoriais',
          endpoints: [
            { metodo: 'GET', rota: '/api/categories', descricao: 'Lista categorias com contadores' },
            { metodo: 'POST', rota: '/api/categories', descricao: 'Cria ou reordena categorias' }
          ],
          cache: 'Redis com invalidação por evento de publicação'
        },
        comentarios: {
          nome: 'comment-service',
          proposito: 'Thread de comentários, moderação e paginação',
          endpoints: [
            { metodo: 'GET', rota: '/api/videos/:id/comments', descricao: 'Página de comentários ordenada por relevância' },
            { metodo: 'POST', rota: '/api/videos/:id/comments', descricao: 'Publica comentário com validação e anti-spam' }
          ],
          seguranca: ['Rate limiting', 'Detecção de spam/abuso', 'Sanitização contra XSS']
        },
        busca: {
          nome: 'search-service',
          proposito: 'Indexação de vídeos, canais e categorias com sugestões em tempo real',
          endpoints: [
            { metodo: 'GET', rota: '/api/search?q=', descricao: 'Busca textual com ranking e filtros' },
            { metodo: 'GET', rota: '/api/suggest?q=', descricao: 'Autocomplete e históricos recentes' }
          ],
          infra: ['Elasticsearch/Opensearch', 'Sincronização assíncrona pós-publicação']
        },
        recomendacao: {
          nome: 'recommendation-service',
          proposito: 'Feed personalizado, trending e notificações de novos vídeos',
          endpoints: [
            { metodo: 'GET', rota: '/api/feed', descricao: 'Lista personalizada com base em histórico e categorias' },
            { metodo: 'GET', rota: '/api/feed/trending', descricao: 'Conteúdos em alta com cache curto' }
          ],
          dados: ['Métricas de view/retention', 'Segmentação anônima + logado', 'AB testing embutido']
        },
        metricas: {
          nome: 'analytics-service',
          proposito: 'Coleta de views, watch time, retenção e engajamento para relatórios e recomendações',
          endpoints: [
            { metodo: 'POST', rota: '/api/metrics/view', descricao: 'Incrementa view com deduplicação por IP/user' },
            { metodo: 'POST', rota: '/api/metrics/watch', descricao: 'Persistência de watch-time agregado' }
          ],
          ingestao: 'Filas + agregação periódica, export para data lake'
        }
      };

      const infraestrutura = {
        armazenamento: ['Buckets versionados para vídeos e miniaturas', 'CDN com edge caching e signed URLs'],
        cache: ['Redis para tokens, sessões e resultados de feed/busca', 'Invalidação por eventos'],
        seguranca: [
          'TLS obrigatório e HSTS',
          'CSRF token em formulários sensíveis',
          'Headers de segurança (CSP, X-Frame-Options, X-Content-Type-Options)',
          'Validação e sanitização server-side de todas as entradas'
        ],
        observabilidade: ['Tracing distribuído', 'Logs estruturados', 'Alertas de latência e erros']
      };

      const fluxos = {
        cadastro: ['POST /api/auth/login', 'POST /api/auth/refresh', 'Persistir perfil e avatar no profile-service'],
        upload: ['POST /api/videos -> fila de transcodificação', 'Callback de finalização atualiza feed e busca'],
        reproducao: ['GET /api/videos/:id para manifest HLS/DASH', 'Entrega via CDN com token temporário'],
        comentarios: ['GET/POST /api/videos/:id/comments com paginação e moderação'],
        clipsOffline: ['Service worker pré-carrega clipes curtos + cache Storage API']
      };

      // Guia de infraestrutura e deploy para garantir resiliência e escalabilidade.
      const deploy = {
        conteinerizacao: {
          imagens: 'Docker slim com multi-stage build para reduzir superfície de ataque',
          orquestracao: 'Kubernetes com namespaces por ambiente (dev/stage/prod)',
          autoscaling: ['HPA por CPU/memória', 'KEDA para picos de ingestão'],
          rede: ['Ingress com TLS e WAF', 'Service mesh opcional para mTLS']
        },
        pipelines: {
          ci: ['Lint e testes unitários (Jest/Cypress smoke)', 'Scan de segurança (SAST/Dependabot)'],
          cd: ['Deploy automatizado em blue/green ou canário', 'Rollback rápido via tags imutáveis'],
          artefatos: 'Registry privado com assinatura de imagens e políticas de retenção'
        },
        ambientes: {
          cloud: ['AWS: EKS + S3 + CloudFront', 'Azure: AKS + Blob Storage + Azure CDN'],
          bancos: ['PostgreSQL gerenciado para dados relacionais', 'Redis gerenciado para cache'],
          storage: 'Buckets com versionamento + replicação cross-region e lifecycle para custo'
        },
        monitoramento: {
          logs: 'Centralização em Elastic/CloudWatch com correlação de trace-id',
          metricas: ['Prometheus + Grafana', 'Alertas de latência/p95, filas e erros 5xx'],
          sintese: 'Checks sintéticos para páginas críticas (home, player, upload)'
        },
        cdnEStreaming: {
          cdnGlobal: 'Distribuição global com edge caching, signed cookies e pré-busca de manifests',
          hotContent: 'Warmup automático para lançamentos e invalidacao seletiva em novas publicações',
          upload: 'Presigned URLs + aceleradores regionais para reduzir latência de ingestão'
        },
        backupERestore: {
          videos: 'Snapshots diários + replicação, testes mensais de restauração',
          banco: 'Backups point-in-time (PITR) com retenção configurável',
          runbooks: 'Passo a passo para recuperar storage, CDN e banco em desastres'
        }
      };

      // Blueprint de dados: esquemas, índices e políticas de backup/replicação.
      const bancos = {
        postgresql: {
          proposito: 'Transações críticas de conta, inscrições, billing e relacionamento entre entidades',
          esquemas: {
            usuarios: {
              campos: ['id SERIAL PRIMARY KEY', 'email UNIQUE NOT NULL', 'senha_hash', 'display_name', 'avatar_url', 'cor_tema', 'created_at TIMESTAMPTZ DEFAULT now()'],
              indices: ['UNIQUE(email)', 'BTREE(display_name)', 'GIN(to_tsvector("portuguese", display_name || coalesce(email, '''')))', 'BRIN(created_at) para ordenação cronológica'],
              politicas: ['Row Level Security para isolar contas', 'Rotação de senha/refresh tokens']
            },
            videos: {
              campos: ['id UUID PRIMARY KEY', 'author_id INTEGER REFERENCES usuarios(id)', 'titulo', 'categoria_id INTEGER', 'privacidade', 'duracao_segundos', 'status_transcodificacao', 'criado_em TIMESTAMPTZ DEFAULT now()'],
              indices: ['BTREE(author_id)', 'BTREE(categoria_id)', 'GIN(to_tsvector("portuguese", titulo))', 'BRIN(criado_em)'],
              politicas: ['FK com ON DELETE CASCADE para comentários', 'Política de retenção para rascunhos antigos']
            },
            categorias: {
              campos: ['id SERIAL PRIMARY KEY', 'nome UNIQUE', 'slug UNIQUE', 'ordem INT'],
              indices: ['UNIQUE(nome)', 'UNIQUE(slug)', 'BTREE(ordem)'],
              politicas: ['Pré-carga em cache e invalidação por evento de publicação']
            },
            comentarios: {
              campos: ['id BIGSERIAL PRIMARY KEY', 'video_id UUID REFERENCES videos(id)', 'author_id INTEGER REFERENCES usuarios(id)', 'texto', 'criado_em TIMESTAMPTZ DEFAULT now()', 'resposta_a BIGINT REFERENCES comentarios(id)'],
              indices: ['BTREE(video_id)', 'BTREE(author_id)', 'GIN(to_tsvector("portuguese", texto))', 'BRIN(criado_em)'],
              politicas: ['Moderação com flags e status', 'Particionamento por video_id para reduzir hot partitions']
            }
          },
          procedimentos: ['Views materializadas para contadores diários', 'Triggers para atualizar métricas resumidas'],
          replicacao: ['Primário/replica com failover automático', 'Backups PITR diários restaurados em dev para testes'],
          migracoes: 'Versionamento com ferramenta tipo Flyway/Liquibase; validação em ambiente de stage antes de produção'
        },
        mongodb: {
          proposito: 'Metadados flexíveis de vídeos (tags, thumbnails, variantes de qualidade) e dados de recomendação',
          colecoes: {
            video_meta: {
              campos: ['_id: videoId', 'tags: [string]', 'thumbs: {default, hd, sd}', 'resolucoes: ["360p","720p","1080p"]', 'feature_flags', 'ab_tests'],
              indices: ['{ tags: 1, created_at: -1 }', '{ "thumbs.default": 1 }', '{ resolucoes: 1 }']
            },
            watch_events: {
              campos: ['userId', 'videoId', 'watchedSeconds', 'timestamp'],
              indices: ['{ videoId: 1, timestamp: -1 }', '{ userId: 1, timestamp: -1 }', '{ videoId: 1, userId: 1 }'],
              sharding: { chave: '{ videoId: 1 }', motivo: 'Distribuir hotspots de vídeos virais' }
            }
          },
          politicas: ['TTL para eventos antigos', 'Change Streams para alimentar recomendação em tempo real']
        },
        redis: {
          proposito: 'Cache de consultas quentes e rate limiting',
          usos: ['Hot videos (trending) com chave mtube:trending', 'Categorias populares com expiração curta', 'Sessões e tokens temporários'],
          expiracao: ['trending: 2 minutos', 'categorias: 10 minutos', 'busca recente: 5 minutos'],
          boasPraticas: ['Chaves nomeadas por ambiente', 'Evitar payloads > 512KB', 'Invalidação por evento de publicação ou edição']
        },
        indexing: {
          principio: 'Indexação guiada por uso real: monitorar planos de consulta e adicionar índices somente quando há ganho mensurável',
          buscas: ['Título de vídeos (PostgreSQL GIN com to_tsvector)', 'Comentários (GIN textual)', 'Tags em MongoDB com compound index'],
          metricas: ['Coleta de planos lentos (slow queries)', 'Alertas quando seq-scan ultrapassar limiares em produção']
        },
        backupERestore: {
          diarios: ['Snapshots PostgreSQL + WAL para PITR', 'Dumps MongoDB (mongodump) com retenção semanal'],
          testes: 'Restauração automática diária em ambiente de desenvolvimento para validar backups',
          restauracaoRapida: ['Playbooks para restaurar índices Redis aquecidos', 'Validação de checksums pós-restore'],
          compliance: ['Criptografia em repouso e em trânsito', 'Segregação de credenciais por ambiente']
        }
      };

      // Exposição global para facilitar inspeção em DevTools e manter a documentação viva.
      window.mtubeServidor = { servicos, infraestrutura, fluxos, deploy, bancos };

      // Log leve em PT-BR para facilitar onboarding de quem está apenas com o front.
      console.groupCollapsed('Blueprint de servidor do MTube');
      console.table(
        Object.values(servicos).map((svc) => ({
          Serviço: svc.nome,
          Propósito: svc.proposito,
          Endpoints: svc.endpoints.map((e) => `${e.metodo} ${e.rota}`).join(' | ')
        }))
      );
      console.log('Infraestrutura recomendada', infraestrutura);
      console.log('Fluxos principais', fluxos);
      console.log('Guia de deploy e operações', deploy);
      console.log('Arquitetura de dados e índices', bancos);
      console.groupEnd();
    })();
  </script>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b42feb7b5622754',t:'MTc2Njc3NzQ1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
 </html>
